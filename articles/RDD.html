<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Regression Discontinuity StudySpecifications • propertee</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Regression Discontinuity StudySpecifications">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">propertee</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Basic</h6></li>
    <li><a class="dropdown-item" href="../articles/intro-to-propertee.html">Introduction to propertee</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/non-binary-treatment.html">Non-binary Treatment Specification</a></li>
    <li><a class="dropdown-item" href="../articles/RDD.html">Regression Discontinuity Designs</a></li>
    <li><a class="dropdown-item" href="../articles/geex_vs_propertee.html">propertee vs. geex</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/benbhansen-stats/propertee/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Regression Discontinuity StudySpecifications</h1>
                        <h4 data-toc-skip class="author">Adam Sales</h4>
            
            <h4 data-toc-skip class="date">2024-11-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/benbhansen-stats/propertee/blob/main/vignettes/RDD.Rmd" class="external-link"><code>vignettes/RDD.Rmd</code></a></small>
      <div class="d-none name"><code>RDD.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="data-and-studyspecification">Data and StudySpecification<a class="anchor" aria-label="anchor" href="#data-and-studyspecification"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">lsoSynth</span><span class="op">)</span></span></code></pre></div>
<p>The data for this example were randomly simulated using the
<code>synthpop</code> package in <code>R</code> based on data originally
collected by <a href="https://www.aeaweb.org/articles?id=10.1257/app.2.2.95" class="external-link">Lindo,
Sanders, and Oreopoulos (2010; hereafter LSO)</a>. (The original real
data can be found <a href="https://www.openicpsr.org/openicpsr/project/113751/version/V1/view" class="external-link">here</a>;
code to simulate the fake data can be found <a href="https://github.com/benbhansen-stats/propertee/blob/main/data-raw/makeRDDdata.r" class="external-link">here</a>.)</p>
<p>At a major public university, students with a cumulative grade point
average (GPA) below a pre-specified cutoff are placed on academic
probation (AP). Students on AP are given extra support, and threatened
with suspension if their GPAs do not improve. See LSO for details. Along
with LSO, we will consider only students at the end of their first year
at the university. The university consisted of three campuses, and they
AP cutoff varied by campus. To simplify matters, we centered each
student’s first year GPA on their campus’s cutoff, creating a new
variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>i</mi></msub><mo>≡</mo><mi>G</mi><mi>P</mi><msub><mi>A</mi><mi>i</mi></msub><mo>−</mo><msub><mi>c</mi><mrow><mi>c</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>u</mi><mi>s</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>i</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub></mrow><annotation encoding="application/x-tex">R_i\equiv GPA_i -c_{campus[i]}</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mi>P</mi><msub><mi>A</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">GPA_i</annotation></semantics></math>
is student
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>’s
first-year GPA, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>c</mi><mrow><mi>c</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>u</mi><mi>s</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>i</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><annotation encoding="application/x-tex">c_{campus[i]}</annotation></semantics></math>
is the AP cutoff for student
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>’s
campus. A student
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
is placed on AP if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>i</mi></msub><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">R_i&lt;0</annotation></semantics></math>
and avoids AP if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>i</mi></msub><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">R_i\ge 0</annotation></semantics></math>.</p>
<p>We will attempt to estimate the average effect of AP placement on
<code>nextGPA</code>, students’ subsequent GPA (either over the summer
or in the following academic semester). This figure plots each the
average <code>nextGPA</code> for students with distinct <code>R</code>
values (i.e. centered first-year GPA). The cutoff for AP, 0, is denoted
with a dotted line. The the sizes of the points are proportional to the
natural log of the numbers of students with each unique value of
<code>R</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">figDat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">lsoSynth</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'nextGPA'</span>,<span class="st">'lhsgrade_pct'</span><span class="op">)</span><span class="op">]</span>,by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>R<span class="op">=</span><span class="va">lsoSynth</span><span class="op">$</span><span class="va">R</span><span class="op">)</span>,</span>
<span>                    FUN<span class="op">=</span><span class="va">mean</span>,na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">figDat</span><span class="op">$</span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">lsoSynth</span><span class="op">$</span><span class="va">R</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">figDat</span>,</span>
<span>     <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">R</span>,<span class="va">nextGPA</span>,cex<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">n</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">3</span>,main<span class="op">=</span><span class="st">'Average Subsequent GPA\n as a function of 1st-Year GPA,\n Centered at AP Cutoff'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="fl">0</span>,lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="RDD_files/figure-html/rddPlots-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<div class="section level3">
<h3 id="regression-discontinuity-studyspecifications">Regression Discontinuity StudySpecifications<a class="anchor" aria-label="anchor" href="#regression-discontinuity-studyspecifications"></a>
</h3>
<p>What characterizes discontinuity (RD) specifications, including the
LSO study, is that treatment is assigned as a function of a numeric
“running variable”
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math>,
along with a prespecified cutoff value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math>,
so that treatment is assigned to subjects
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
for whom
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>i</mi></msub><mo>&gt;</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">R_i&gt;c</annotation></semantics></math>,
or for whom
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>i</mi></msub><mo>&lt;</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">R_i&lt;c</annotation></semantics></math>.
If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Z</mi><mi>i</mi></msub><annotation encoding="application/x-tex">Z_i</annotation></semantics></math>
denote’s
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>’s
treatment assignment, we write
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mi>i</mi></msub><mo>=</mo><mn>𝟏</mn><mo stretchy="false" form="prefix">{</mo><msub><mi>R</mi><mi>i</mi></msub><mo>&lt;</mo><mi>c</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">Z_i=\mathbf{1}\{R_i&lt;c\}</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>𝟏</mn><mo stretchy="false" form="prefix">{</mo><msub><mi>R</mi><mi>i</mi></msub><mo>&lt;</mo><mi>c</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\mathbf{1}\{R_i&lt;c\}</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>𝟏</mn><mo stretchy="false" form="prefix">{</mo><mi>x</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\mathbf{1}\{x\}</annotation></semantics></math>
is the indicator function–equal to 1 when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
is true and 0 otherwise. In the LSO study,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
indexes students, centered first-year GPA $R_i $ is the running
variable, and the treatment under study is AP placement. Then $
Z_i={R_i&lt;0} $. (In “fuzzy” RD specifications,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math>’s
value relative to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math>
doesn’t completely determine treatment, but merely affects the
probability of treatment, so subjects with, say,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>i</mi></msub><mo>&gt;</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">R_i&gt;c</annotation></semantics></math>
are more likely to be treated than those with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>i</mi></msub><mo>&lt;</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">R_i&lt;c</annotation></semantics></math>;
in fuzzy RD specifications,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Z</mi><mi>i</mi></msub><mo>=</mo><mn>𝟏</mn><mo stretchy="false" form="prefix">{</mo><msub><mi>R</mi><mi>i</mi></msub><mo>&gt;</mo><mi>c</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">Z_i=\mathbf{1}\{R_i&gt;c\}</annotation></semantics></math>
is typically modeled as an instrument for treatment receipt.)</p>
<p>RD specifications hold a privileged place in causal inference,
because unlike most other observational study specifications, the
mechanism for treatment assignment is known. That is,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math>
is the only confounder. On the other hand, since
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
is completely determined by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math>,
there are no subjects with the same values for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math>
but different values for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>,
so common observational study techniques, such as matching on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math>,
are impossible. Instead, it is necessary to adjust for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math>
with modeling–typically regression.</p>
</div>
<div class="section level3">
<h3 id="analyzing-rd-studyspecifications-with-ancova">Analyzing RD StudySpecifications with ANCOVA<a class="anchor" aria-label="anchor" href="#analyzing-rd-studyspecifications-with-ancova"></a>
</h3>
<p>Traditionally, the typical way to analyze data from RD specifications
is with ANCOVA, by fitting a regression model such as
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mi>i</mi></msub><mo>=</mo><msub><mi>β</mi><mn>0</mn></msub><mo>+</mo><msub><mi>β</mi><mn>1</mn></msub><msub><mi>R</mi><mi>i</mi></msub><mo>+</mo><msub><mi>β</mi><mn>2</mn></msub><msub><mi>Z</mi><mi>i</mi></msub><mo>+</mo><msub><mi>ϵ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">Y_i=\beta_0+\beta_1R_i+\beta_2Z_i+\epsilon_i</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">Y_i</annotation></semantics></math>
is the outcome of interest measured for subject
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
(in our example <code>nextGPA</code>), and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϵ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\epsilon_i</annotation></semantics></math>
is a random regression error. Then, the regression coefficient for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mn>2</mn></msub><annotation encoding="application/x-tex">\beta_2</annotation></semantics></math>,
is taken as an estimate of the treatment effect. Common methodological
updates to the ANCOVA approach include an interaction term between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Z</mi><mi>i</mi></msub><annotation encoding="application/x-tex">Z_i</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>i</mi></msub><annotation encoding="application/x-tex">R_i</annotation></semantics></math>,
and the substitution semi-parametric regression, such as local linear or
polynomial models, for linear ordinary least squares.</p>
<p>Under suitable conditions, the ANCOVA model is said to estimate a
“Local Average Treatment Effect” (LATE). If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mn>1</mn></msub><annotation encoding="application/x-tex">Y_1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mn>0</mn></msub><annotation encoding="application/x-tex">Y_0</annotation></semantics></math>
are the potential outcomes for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>,
then the LATE is defined as
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><munder><mo>lim</mo><mrow><mi>r</mi><mo>→</mo><msup><mi>c</mi><mo>+</mo></msup></mrow></munder><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Y</mi><mn>1</mn></msub><mo stretchy="false" form="prefix">|</mo><mi>R</mi><mo>=</mo><mi>r</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><munder><mo>lim</mo><mrow><mi>r</mi><mo>→</mo><msup><mi>c</mi><mo>−</mo></msup></mrow></munder><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Y</mi><mn>0</mn></msub><mo stretchy="false" form="prefix">|</mo><mi>R</mi><mo>=</mo><mi>r</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\displaystyle\lim_{r\rightarrow c^+} E(Y_1|R=r)-\displaystyle\lim_{r\rightarrow c^-} E(Y_0|R=r)</annotation></semantics></math>
or equivalently
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><munder><mo>lim</mo><mrow><mi>Δ</mi><mo>→</mo><msup><mn>0</mn><mo>+</mo></msup></mrow></munder><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Y</mi><mn>1</mn></msub><mo>−</mo><msub><mi>Y</mi><mn>0</mn></msub><mo stretchy="false" form="prefix">|</mo><mi>R</mi><mo>∈</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>c</mi><mo>−</mo><mi>Δ</mi><mo>,</mo><mi>c</mi><mo>+</mo><mi>Δ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\displaystyle\lim_{\Delta\rightarrow 0^+} E(Y_1-Y_0 |R\in (c-\Delta,c+\Delta))</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>E</mi><annotation encoding="application/x-tex">E</annotation></semantics></math>
denotes expectation–that is, the LATE is the limit of average treatment
effects for subjects with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math>
in ever-shrinking regions around
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math>.</p>
<p>Among other considerations, the LATE target suggests that data
analysts restrict their attention to subjects with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math>
falling within a bandwidth
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">b&gt;0</annotation></semantics></math>
of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math>,
e.g. only fitting the model to subjects
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
with within a “window of analysis”
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝒲</mi><mo>=</mo><mo stretchy="false" form="prefix">{</mo><mi>i</mi><mo>:</mo><msub><mi>R</mi><mi>i</mi></msub><mo>∈</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>c</mi><mo>−</mo><mi>b</mi><mo>,</mo><mi>c</mi><mo>+</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\mathcal{W}=\{i:R_i\in (c-b,c+b)\}</annotation></semantics></math>.
A number of methods have been proposed to select
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>b</mi><annotation encoding="application/x-tex">b</annotation></semantics></math>,
including cross validation, non-parametric modeling of the second
derivative of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>r</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Y</mi><mo stretchy="false" form="prefix">|</mo><mi>R</mi><mo>=</mo><mi>r</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f(r)=E(Y|R=r)</annotation></semantics></math>,
and specification tests.</p>
</div>
<div class="section level3">
<h3 id="the-propertee-approach-to-rd-studyspecifications">The <strong>propertee</strong> Approach to RD
StudySpecifications<a class="anchor" aria-label="anchor" href="#the-propertee-approach-to-rd-studyspecifications"></a>
</h3>
<p>The <strong>propertee</strong> approach to RD specifications breaks
the data analysis into three steps:</p>
<ol style="list-style-type: decimal">
<li>Conduct specification tests and choose a bandwidth
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">b&gt;0</annotation></semantics></math>,
along with, possibly, other data exclusions, resulting in an analysis
sample
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>.</li>
<li>Fit a covariance model
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mrow><mi>i</mi><mn>0</mn></mrow></msub><mo>=</mo><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>R</mi><mi>i</mi></msub><mo>,</mo><msub><mi>x</mi><mi>i</mi></msub><mo>;</mo><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Y_{i0}=g(R_i,x_i;\beta)</annotation></semantics></math>,
modeling
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mrow><mi>i</mi><mn>0</mn></mrow></msub><annotation encoding="application/x-tex">Y_{i0}</annotation></semantics></math>
as a function of running variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>i</mi></msub><annotation encoding="application/x-tex">R_i</annotation></semantics></math>
and (optionally) other covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐱</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mathbf{x}_i</annotation></semantics></math>.
Fitting a covariance model to only the control subjects, as in other
specifications, would entail extrapolation of a model fit to subjects
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>i</mi></msub><mo>∈</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>c</mi><mo>−</mo><mi>b</mi><mo>,</mo><mi>c</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">R_i\in (c-b,c)</annotation></semantics></math>
to subjects with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>i</mi></msub><mo>∈</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>c</mi><mo>,</mo><mi>c</mi><mo>+</mo><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">R_i\in (c,c+b)</annotation></semantics></math>,
or vice-versa, which is undesirable. Instead, we fit the covariance
model to the full analysis sample
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝒲</mi><annotation encoding="application/x-tex">\mathcal{W}</annotation></semantics></math>,
including both treated and untreated subjects. However, since we are
interested in modeling
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mn>0</mn></msub><annotation encoding="application/x-tex">Y_0</annotation></semantics></math>,
and not
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mn>1</mn></msub><annotation encoding="application/x-tex">Y_1</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>,
so rather than fitting
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>⋅</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(\cdot)</annotation></semantics></math>,
we fit an extended model
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>g</mi><mo accent="true">̃</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>R</mi><mi>i</mi></msub><mo>,</mo><msub><mi>x</mi><mi>i</mi></msub><mo>,</mo><msub><mi>Z</mi><mi>i</mi></msub><mo>;</mo><mi>β</mi><mo>,</mo><mi>γ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>R</mi><mi>i</mi></msub><mo>,</mo><msub><mi>x</mi><mi>i</mi></msub><mo>;</mo><mi>β</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>γ</mi><msub><mi>Z</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\tilde{g}(R_i,x_i,Z_i;\beta,\gamma)=g(R_i,x_i;\beta)+\gamma Z_i</annotation></semantics></math>
including a term for treatment assignment. The estimate for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>γ</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math>
is, in essence, a provisional estimate of the treatment effect.</li>
<li>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>Y</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mn>0</mn></mrow></msub><mo>=</mo><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>R</mi><mi>i</mi></msub><mo>,</mo><msub><mi>x</mi><mi>i</mi></msub><mo>;</mo><mover><mi>β</mi><mo accent="true">̂</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\widehat{Y}_{i0}=g(R_i,x_i;\hat{\beta})</annotation></semantics></math>,
using only the model for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mn>0</mn></msub><annotation encoding="application/x-tex">Y_0</annotation></semantics></math>—not
including the term for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>—along
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>β</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{\beta}</annotation></semantics></math>
estimated in step 2. Then estimate the average treatment effect for
subjects in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>
using the difference in means estimator:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mover><mi>β</mi><mo accent="true">̂</mo></mover></msub><mo>=</mo><mfrac><mrow><munder><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi>W</mi></mrow></munder><msub><mi>Z</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Y</mi><mi>i</mi></msub><mo>−</mo><msub><mover><mi>Y</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mn>0</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><munder><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi>W</mi></mrow></munder><msub><mi>Z</mi><mi>i</mi></msub></mrow></mfrac><mo>−</mo><mfrac><mrow><munder><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi>W</mi></mrow></munder><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><msub><mi>Z</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Y</mi><mi>i</mi></msub><mo>−</mo><msub><mover><mi>Y</mi><mo accent="true">̂</mo></mover><mrow><mi>i</mi><mn>0</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><munder><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi>W</mi></mrow></munder><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><msub><mi>Z</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">
d_{\hat{\beta}}=\frac{\sum_{i\in W} Z_i(Y_i-\widehat{Y}_{i0})}{\sum_{i \in W} Z_i}-\frac{\sum_{i\in W} (1-Z_i)(Y_i-\widehat{Y}_{i0})}{\sum_{i \in W} (1-Z_i)}
</annotation></semantics></math>
</li>
</ol>
<p>The estimator
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>d</mi><mover><mi>β</mi><mo accent="true">̂</mo></mover></msub><annotation encoding="application/x-tex">d_{\hat{\beta}}</annotation></semantics></math>
will be consistent if the model
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>R</mi><mi>i</mi></msub><mo>,</mo><msub><mi>x</mi><mi>i</mi></msub><mo>;</mo><msub><mi>β</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(R_i,x_i;\beta_0)</annotation></semantics></math>,
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\beta_0</annotation></semantics></math>
as the probability limit for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>β</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{\beta}</annotation></semantics></math>,
successfully removes all confounding due to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math>,
i.e. <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mn>0</mn></msub><mo>−</mo><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>R</mi><mi>i</mi></msub><mo>,</mo><msub><mi>x</mi><mi>i</mi></msub><mo>;</mo><msub><mi>β</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>⊥</mo><mspace width="-0.167em"></mspace><mspace width="-0.167em"></mspace><mspace width="-0.167em"></mspace><mo>⊥</mo><mi>Z</mi></mrow><annotation encoding="application/x-tex">Y_0-g(R_i,x_i;\beta_0) \perp \!\!\! \perp Z</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>∈</mo><mi>𝒲</mi></mrow><annotation encoding="application/x-tex">i\in \mathcal{W}</annotation></semantics></math>.</p>
</div>
</div>
<div class="section level2">
<h2 id="analyzing-an-rd-specification-in-propertee">Analyzing an RD specification in <strong>propertee</strong><a class="anchor" aria-label="anchor" href="#analyzing-an-rd-specification-in-propertee"></a>
</h2>
<div class="section level3">
<h3 id="determining-the-window-of-analysis">Determining the window of analysis<a class="anchor" aria-label="anchor" href="#determining-the-window-of-analysis"></a>
</h3>
<p>There is an extensive literature on determining the appropriate
window of analysis for an RD specification. See, for instance, Imbens
and Kalyanaraman (2012) and Sales and Hansen (2020). This stage of the
analysis is beyond the scope of this vignette, and does not require the
propertee package. For the purpose of this example, we will focus our
analysis on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝒲</mi><mo>=</mo><mo stretchy="false" form="prefix">{</mo><mi>i</mi><mo>:</mo><msub><mi>R</mi><mi>i</mi></msub><mo>∈</mo><mrow><mo stretchy="true" form="prefix">[</mo><mo>−</mo><mn>0.5</mn><mo>,</mo><mn>0.5</mn><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\mathcal{W}=\{i:R_i\in [-0.5,0.5]\}</annotation></semantics></math>.</p>
</div>
<div class="section level3">
<h3 id="initializing-the-rd-studyspecification-object">Initializing the RD StudySpecification Object<a class="anchor" aria-label="anchor" href="#initializing-the-rd-studyspecification-object"></a>
</h3>
<p>In general, <strong>propertee</strong> specification objects require
users to specify a unit of assignment variable, that corresponds to the
level of treatment assignment–in other words, which units were assigned
between conditions. This is necessary both for combining results across
different models or datasets, and for estimating correct
specification-based standard errors. In <code>lsoSynth</code>, there are
no clusters, and individual students are assigned to academic probation
on an individual basis. The dataset does not include an ID variable, but
any variable that takes a unique value for each row will do. We will use
row-names.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lsoSynth</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">lsoSynth</span><span class="op">)</span></span></code></pre></div>
<p>Defining an RD specification requires, at minimum, identifying the
running variable(s)
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math>,
as well as how
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math>
determines treatment assignment. In our example,</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lsoSynth</span><span class="op">$</span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="va">lsoSynth</span><span class="op">$</span><span class="va">R</span><span class="op">&lt;</span><span class="fl">0</span></span>
<span></span>
<span><span class="va">lsoSynthW</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">lsoSynth</span>,<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span><span class="op">&lt;=</span><span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#lsoSynthW$id &lt;- 1:nrow(lsoSynthW)</span></span>
<span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/StudySpecification_objects.html">rd_spec</a></span><span class="op">(</span><span class="va">Z</span> <span class="op">~</span> <span class="fu"><a href="../reference/StudySpecificationSpecials.html">forcing</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/StudySpecificationSpecials.html">unitid</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>, data<span class="op">=</span><span class="va">lsoSynth</span>, subset<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">lsoSynth</span><span class="op">$</span><span class="va">R</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="modeling-y_c-as-a-function-of-r">Modeling
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mi>C</mi></msub><annotation encoding="application/x-tex">Y_C</annotation></semantics></math>
as a function of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math><a class="anchor" aria-label="anchor" href="#modeling-y_c-as-a-function-of-r"></a>
</h3>
<p>We will consider two potential models
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>g</mi><mo accent="true">̃</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mo>⋅</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\tilde{g}(\cdot)</annotation></semantics></math>
of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mi>C</mi></msub><annotation encoding="application/x-tex">Y_C</annotation></semantics></math>
as a function of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math>.
First, the standard OLS model:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="do">### this doesn't work:</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(nextGPA <span class="sc">~</span> R <span class="sc">+</span> Z, <span class="at">data =</span> lsoSynth, <span class="at">weights =</span> <span class="fu">ett</span>(spec)</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##this works, but it's annoying to enter in the subset expression a 2nd time:</span></span>
<span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">nextGPA</span> <span class="op">~</span> <span class="va">R</span> <span class="op">+</span> <span class="va">Z</span>, data <span class="op">=</span> <span class="va">lsoSynth</span>, subset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p>The second is a bounded-influence polynomial model of the type
recommended in Sales &amp; Hansen (2020):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g2</span> <span class="op">&lt;-</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"robustbase"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu">robustbase</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/robustbase/man/lmrob.html" class="external-link">lmrob</a></span><span class="op">(</span><span class="va">nextGPA</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">R</span>,<span class="fl">5</span><span class="op">)</span><span class="op">+</span><span class="va">Z</span>,data<span class="op">=</span><span class="va">lsoSynthW</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="va">g1</span></span></code></pre></div>
<p>[Put something here evaluating them?]</p>
</div>
<div class="section level3">
<h3 id="estimating-effects">Estimating Effects<a class="anchor" aria-label="anchor" href="#estimating-effects"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">yhat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">g1</span>,<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>R<span class="op">=</span><span class="fu"><a href="../reference/StudySpecification_extractreplace.html">forcings</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,Z<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">yhat2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">g2</span>,<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>R<span class="op">=</span><span class="fu"><a href="../reference/StudySpecification_extractreplace.html">forcings</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,Z<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">yhat1</span>,<span class="va">yhat2</span><span class="op">)</span></span></code></pre></div>
<p><img src="RDD_files/figure-html/yhat-1.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### method 1:</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lsoSynthW</span><span class="op">$</span><span class="va">nextGPA</span><span class="op">[</span><span class="va">lsoSynthW</span><span class="op">$</span><span class="va">Z</span><span class="op">]</span><span class="op">-</span><span class="va">yhat1</span><span class="op">[</span><span class="va">lsoSynthW</span><span class="op">$</span><span class="va">Z</span><span class="op">]</span><span class="op">)</span><span class="op">-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lsoSynthW</span><span class="op">$</span><span class="va">nextGPA</span><span class="op">[</span><span class="op">!</span><span class="va">lsoSynthW</span><span class="op">$</span><span class="va">Z</span><span class="op">]</span><span class="op">-</span><span class="va">yhat1</span><span class="op">[</span><span class="op">!</span><span class="va">lsoSynthW</span><span class="op">$</span><span class="va">Z</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.2553202</span></span>
<span></span>
<span><span class="co">#### method 2:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">nextGPA</span><span class="op">~</span><span class="va">Z</span>, offset<span class="op">=</span><span class="va">yhat1</span>,data<span class="op">=</span><span class="va">lsoSynthW</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">'ZTRUE'</span><span class="op">]</span></span>
<span><span class="co">#&gt;     ZTRUE </span></span>
<span><span class="co">#&gt; 0.2553202</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### method 1:</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lsoSynthW</span><span class="op">$</span><span class="va">nextGPA</span><span class="op">[</span><span class="va">lsoSynthW</span><span class="op">$</span><span class="va">Z</span><span class="op">]</span><span class="op">-</span><span class="va">yhat2</span><span class="op">[</span><span class="va">lsoSynthW</span><span class="op">$</span><span class="va">Z</span><span class="op">]</span><span class="op">)</span><span class="op">-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lsoSynthW</span><span class="op">$</span><span class="va">nextGPA</span><span class="op">[</span><span class="op">!</span><span class="va">lsoSynthW</span><span class="op">$</span><span class="va">Z</span><span class="op">]</span><span class="op">-</span><span class="va">yhat2</span><span class="op">[</span><span class="op">!</span><span class="va">lsoSynthW</span><span class="op">$</span><span class="va">Z</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.2295554</span></span>
<span></span>
<span><span class="co">#### method 2:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">nextGPA</span><span class="op">~</span><span class="va">Z</span>, offset<span class="op">=</span><span class="va">yhat2</span>,data<span class="op">=</span><span class="va">lsoSynthW</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">'ZTRUE'</span><span class="op">]</span></span>
<span><span class="co">#&gt;     ZTRUE </span></span>
<span><span class="co">#&gt; 0.2295554</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Josh Errickson, Josh Wasserman, Ben Hansen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
