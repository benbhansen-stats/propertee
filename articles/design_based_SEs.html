<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="propertee">
<title>Design based sandwich SEs for differences of Hajek estimators • propertee</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Design based sandwich SEs for differences of Hajek estimators">
<meta property="og:description" content="propertee">
<meta property="og:image" content="www.github.com/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">propertee</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.4.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Basic</h6>
    <a class="dropdown-item" href="../articles/intro-to-propertee.html">Introduction to propertee</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Advanced</h6>
    <a class="dropdown-item" href="../articles/non-binary-treatment.html">Non-binary Treatment Specification</a>
    <a class="dropdown-item" href="../articles/RDD.html">Regression Discontinuity Designs</a>
    <a class="dropdown-item" href="../articles/not-for-cran/geex_vs_propertee.html">propertee vs. geex</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Theory</h6>
    <a class="dropdown-item" href="../articles/sandwich_infrastructure.html">Data structures to support standard error calculations for direct adjustment assisted by a prior covariance model</a>
    <a class="dropdown-item" href="../articles/LinearModelVarianceEstimation.html">Variance Estimation Testing Using A Simple Linear Specification</a>
    <a class="dropdown-item" href="../articles/design_based_SEs.html">Design based sandwich SEs for differences of Hajek estimators</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/benbhansen-stats/propertee/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Design based sandwich SEs for differences of Hajek estimators</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/benbhansen-stats/propertee/blob/HEAD/vignettes/design_based_SEs.Rmd" class="external-link"><code>vignettes/design_based_SEs.Rmd</code></a></small>
      <div class="d-none name"><code>design_based_SEs.Rmd</code></div>
    </div>

    
    
<p>We’ve promised to provide sandwich-type SEs for estimates of
treatment effect, with stacking of estimated equations as appropriate to
address possible use of separate regression fits to estimate covariance
adjustment terms and then to estimate marginal treatment effects. Often
``sandwich standard error’’ conjures an expectation of standard errors
that are model-based in the sense of assuming i.i.d. data <span class="math inline">\((A_i,  W_{i}, X_i, Y_{0i}, \ldots Y_{Ki})\)</span>
and making inference conditional on the values of treatment assignments
<span class="math inline">\(A \in
\{0, \ldots, K\}\)</span>, importance or frequency weights <span class="math inline">\(W\)</span>, and covariates <span class="math inline">\(X\)</span>, but not the values of potential
responses <span class="math inline">\(\{Y_k: k \leq K\}\)</span>. (This
document takes <span class="math inline">\(i\)</span> to range over
intact clusters.) With the i.i.d assumption, these model-based SEs are
valid even if the design specification isn’t, provided that the outcome
model is well-specified. The role of the study design is to provide
analysis weights which, if respected, ensure desired interpretations of
marginal effect estimators if the <span class="math inline">\(Y\)</span>-model happens to be misspecified.</p>
<p>An alternative would be to offer sandwich standard errors under a
design-based interpretation, differing from the above principally in
terms of conditioning on</p>
<p><span class="math display">\[\mathcal{Z} = \sigma(\{(X_i, Y_{0i},
\ldots Y_{Ki}): i\}, \{\sum_{i
    \in S}\, \![A_i=k\!] : k \in \{0, \ldots, K\}; S  \in \mathcal{P}\}
)\]</span></p>
<p>where <span class="math inline">\(\mathcal{P}\)</span> is a given
partition of {1,, n} encoding a stratification. Of particular interest
are standard errors for Hajek estimators, i.e. estimators of form <span class="math display">\[\hat{\mu}_k[\mathbf{v}] = \frac{\sum_i
\check{w}_{i[k]} [\![A_i=k]\!] v_i}{\sum_i
\check{w}_{i[k]}  [\![A_i=k]\!]}\]</span> and their differences <span class="math display">\[\begin{equation}\label{eq:hajekdiff}
\hat{\mu}_k[\mathbf{u}] - \hat{\mu}_0[\mathbf{v}].
\end{equation}\]</span> The case weights <span class="math inline">\(\{\check{w}_{i[k]}:i\leq n, k\leq K\}\)</span> are
the products of a frequency or importance weight <span class="math inline">\(w_{i}\)</span> and, as appopriate, a weighting
factor representing a reciprocal of <span class="math inline">\(i\)</span>’s probability (or odds) of assignment
to <span class="math inline">\(k\)</span> (or to one of {<span class="math inline">\(k, \ldots,
K\)</span>}); in general differ by <span class="math inline">\(k\)</span>. With <span class="math inline">\(\check{w}_{i[j]} =[\mathbb{P}(A_{i}=j \mid
\mathcal{Z}]^{-1}\)</span> for <span class="math inline">\(j=0, \ldots,
K\)</span>, <span class="math inline">\(\hat{\mu}_k[\mathbf{y}_{k}] -
\hat{\mu}_0[\mathbf{y}_{0}]\)</span> is the natural estimate of the
effect of treatment <span class="math inline">\(k\)</span> within the
experimental or quasiexperimental study sample, <span class="math inline">\(n^{-1}\sum_{i=1}^{n}(y_{ki}-y_{k0})\)</span>. This
is also known as the sample average treatment effect. If the
experimental observations are samples from a broader super-population,
with sample inclusion probabilities <span class="math inline">\(\pi_{1},
\ldots, \pi_{n}\)</span>, then setting <span class="math inline">\(\check{w}_{i[j]}
=\pi_{i}^{-1}[\mathbb{P}(A_{i}=j)]^{-1}\)</span> for <span class="math inline">\(j=0, \ldots, K\)</span> makes <span class="math inline">\(\hat{\mu}_k[\mathbf{y}_{k}] -
\hat{\mu}_0[\mathbf{y}_{0}]\)</span> into the corresponding natural
estimate of the population average treatment effect.</p>
In one special case a design-based SE for <span class="math inline">\(\eqref{eq:hajekdiff}\)</span> has been available
for some time, with an optional interpretation in terms of M-estimation
emerging more recently. Suppose:
<p>In this case the variance estimate used in the 2 sample <span class="math inline">\(t\)</span> test without pooling of variances
validly estimates the variance of <span class="math inline">\(\eqref{eq:hajekdiff}\)</span>, in the following
sense. If <span class="math inline">\(v\)</span> is observed only when
<span class="math inline">\(A=k\)</span> while <span class="math inline">\(u\)</span> is observed only when <span class="math inline">\(A=0\)</span>, then <span class="math inline">\(s_{vu} = (n-1)^{-1} \sum_{i=1}^n (v_i - \bar
v)(u_i - \bar v)\)</span> is not identified; as far as the data are
concerned, it could lie anywhere between <span class="math inline">\(\pm
s_{v} s_{u}\)</span>, where <span class="math inline">\(s_{v}^2 = s_{vv}
= (n-1)^{-1} \sum_{i=1}^n (v_i - \bar v)^2\)</span>. Assuming <span class="math inline">\(s_{vu} = s_{v}s_{u}\)</span>, then the ordinary
unpooled variance is unbiased for the design-based variance (conditional
variance given <span class="math inline">\(\mathcal{Z}\)</span>) of
<span class="math inline">\(\eqref{eq:hajekdiff}\)</span>. If on the
other hand <span class="math inline">\(s_{uv} \leq s_{v}s_{u}\)</span>,
then the expected value of this ordinary unpooled variance exceeds <span class="math inline">\(\eqref{eq:hajekdiff}\)</span>’s design-based
variance . The possibilities <span class="math inline">\(s_{vu} =
s_{v}s_{u}\)</span> and <span class="math inline">\(s_{vu} \leq
s_{v}s_{u}\)</span> being exhaustive, by Cauchy-Schwartz, the expected
value of the unpooled variance can be no less than <span class="math inline">\(\mathrm{Var}(\hat{\mu}_k[\mathbf{u}] -
\hat{\mu}_0[\mathbf{v}] \mid \mathcal{Z})\)</span>; it is valid as a
possibly conservative estimate in that it cannot be negatively
biased.</p>
<p>As shown by , in this case the same variance estimate coincides with
the HC2 flavor of the Huber-White estimate. As a result, it’s sometimes
said that ordinary sandwich or cluster-robust variance estimates admit
of design-based interpretations provided that one uses the HC2 form. I
suspect this works only in special cases, however, perhaps not going far
beyond the one delimited above.</p>
<p>The use of the Neyman insight to get design-based SEs through
Huber-White covariance estimates intended for model-based interpretation
has several important limitations.</p>
The M-estimation framework promises solutions to many or all of these
impediments.
<p>The Hajek estimators <span class="math inline">\(\hat{\mu}_{0}[\mathbf{y}_{0}]\)</span>, , <span class="math inline">\(\hat{\mu}_{k}[\mathbf{y}_{k}]\)</span> admit of
being defined as the unique multivariate root of the estimating function
<span class="math display">\[\begin{equation} \label{eq:ee-hajekdiff}
(\mu_{0}, \ldots, \mu_{K}) \mapsto
  \left[
\begin{array}{c}
\sum_i [\![a_i=K]\!] \check{w}_{i[K]} (y_{Ki} - \mu_K) \\
\vdots \\
\sum_i [\![a_i=0]\!] \check{w}_{i[0]} (y_{0i} - \mu_0)
\end{array}
\right]
.
\end{equation}\]</span></p>
<p>The information matrices <span class="math inline">\(A(\mu_0, \ldots,
\mu_K)\)</span> corresponding to <span class="math inline">\(\eqref{eq:ee-hajekdiff}\)</span> are diagonal. For
a sandwich estimate of variance, then, we only need estimates of the
covariance of~<span class="math inline">\(\eqref{eq:ee-hajekdiff}\)</span>. In the
one-stratum case with multiple representatives of conditions <span class="math inline">\(k\)</span> and <span class="math inline">\(0\)</span>, we can simply apply Neyman’s
two-sample unpooled variances SE to observations <span class="math inline">\(\{ \check{w}_{i[k]}
(y_{ki} - \mu_k) : A_i = k\}\)</span> and <span class="math inline">\(\{
\check{w}_{i[0]} (y_{0i} - \mu_0) : A_i =
0\}\)</span>. Impediment~<span class="math inline">\(\ref{it:prob-noweights}\)</span> is solved.</p>
<p>For standard errors of the difference of Hajek estimators within a
subgroup <span class="math inline">\(g\)</span>, <span class="math display">\[\begin{equation*}
\frac{\sum_i \check{w}_{i[k]} [\![A_i=k, G_{i} =g]\!] y_{ki}}{\sum_i
\check{w}_{i[k]}
     [\![A_i=k, G_{i}=g]\!]}
-
  \frac{\sum_i \check{w}_{i[0]} [\![A_i=0, G_{i} =g]\!] y_{0i}}{\sum_i
\check{w}_{i[0]}
     [\![A_i=0, G_{i}=g]\!]},
\end{equation*}\]</span> we can simply fold the subgroup indicator into
the weights, weighting by <span class="math inline">\(\{\tilde{w}_{i[j]}:j; i\} =
\{\check{w}_{i[j]}[\![G_{i}=g]\!]: j; i\}\)</span> as opposed to <span class="math inline">\(\{\check{w}_{i[j]}:j;
i\}\)</span>. This solves the first part of Impediment~<span class="math inline">\(\ref{it:moderators-multiple-outcomes}\)</span>.</p>
<p>(The remaining piece of Impediment~<span class="math inline">\(\ref{it:moderators-multiple-outcomes}\)</span> is
the need for estimates of <span class="math display">\[\begin{equation*}
  \mathrm{Cov}\left(
    \frac{\sum_i \check{w}_{i[k]} [\![A_i=k]\!] v_{ki}}{\sum_i
\check{w}_{i[k]}
      [\![A_i=k]\!]} -
    \frac{\sum_i \check{w}_{i[k]} [\![A_i=k]\!] v_{0i}}{\sum_i
\check{w}_{i[k]}  [\![A_i=k]\!]},
  \frac{\sum_i \check{w}_{ki} [\![A_i=k]\!] u_{ki}}{\sum_i
\check{w}_{ki}
      [\![A_i=k]\!]} -
    \frac{\sum_i \check{w}_{ki} [\![A_i=k]\!] u_{0i}}{\sum_i
\check{w}_{ki}  [\![A_i=k]\!]}
  \right)
\end{equation*}\]</span> where <span class="math inline">\(v_{ji}\)</span> and <span class="math inline">\(u_{ji}\)</span> are observed only when <span class="math inline">\(A_{i}=j\)</span>, all <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>. I haven’t had the opportunity to sit
down and try to work this out, but I’m optimistic that this can be
handled with straightforward extensions of the Neyman insight.)</p>
<p>Under the design-based interpretation, variances and covariances of
quantile regression estimating functions — for a quantile regression
with covariates <span class="math inline">\(X\)</span> and <span class="math inline">\(c_{i}\)</span> observations per cluster <span class="math inline">\(i\)</span>, <span class="math display">\[\begin{equation*}
\beta \mapsto  \sum_{i=1}^{n}\sum_{j=1}^{c_{i}}\sum_{k=0}^{K}
x_{ij}([\![y_{kij} -
  X_{ij}'\beta, a_{i}= k)]\!] - \tau)
\end{equation*}\]</span> — are likely to be estimable in much the same
way as variances and covariances of estimating functions for other forms
of regression. In any case, there will be no need for estimation of a
sparsity parameter. The impediment is removed.</p>
<p>(Quantile regression doesn’t bear any of its usual interpretations
under conditioning on <span class="math inline">\(\mathcal{Z}\)</span>,
but that doesn’t matter for purposes of using it to estimate slopes in
an RDD.)</p>
<p>Now consider Impediment~<span class="math inline">\(\ref{it:prob-multreps}\)</span>, strata <span class="math inline">\(S\)</span> in which one or both of the conditions
<span class="math inline">\(j\)</span> being contrasted have only one
representative, <span class="math inline">\(\sum_{i\in S}
[\![A_{i}=j]\!] =1\)</span>. Consider the situation without
covariates.</p>
<p>As there is independence across if not within strata, the B matrices
corresponding to~<span class="math inline">\(\eqref{eq:ee-hajekdiff}\)</span> are sums of
stratum-wise contributions <span class="math display">\[\begin{equation}
\label{eq:Bform}
B_S((\mu_0, \ldots, \mu_K)) =
\mathrm{Cov}\left(\left[
\begin{array}{c}
\sum_{i\in S} [\![A_i=K]\!] \check{w}_{i[K]} (y_{Ki} - \mu_K) \\
\vdots \\
\sum_{i\in S} [\![A_i=0]\!] \check{w}_{i[0]} (y_{0i} - \mu_0)
\end{array}
\right] \mid \mathcal{Z}\right), \quad S \in \mathcal{P}.
\end{equation}\]</span> For any stratum <span class="math inline">\(S\)</span> and condition <span class="math inline">\(k\)</span> s.t. <span class="math inline">\(\sum_{i \in S}  [\![A_i=k]\!] =1\)</span>, <span class="math inline">\(\mathrm{Var}\left\{ \sum_{i\in S} [\![A_i=k]\!]
\check{w}_{i[k]} (y_{ki} - \mu_k) \right\}\)</span> is not estimable,
just as the variance <span class="math inline">\([(\# S)-1]^{-1}\sum_{i
\in S} (y_{ki} - \bar{y}_k)^2\)</span> is not estimable. On the other
hand, the second moment <span class="math display">\[
\mathbb{E}\left[\left\{ \sum_{i\in S} [\![A_i=k]\!] \check{w}_{i[k]}
(y_{ki} - \mu_k) \right\}^2\right]
\]</span> estimable, by it sample realization <span class="math inline">\(\left\{ \sum_{i\in
    S} [\![a_i=k]\!] \check{w}_{i[k]} (y_{ki} - \mu_k)
\right\}^2\)</span>: in M-estimation, we’re entitled to treat <span class="math inline">\(\mu_k\)</span> is a fixed constant, not a random
variable. Since the second moment bounds the variance from above, <span class="math inline">\(\{\sum_{i\in S} [\![A_i=k]\!] \check{w}_{i[k]}
(y_{ki} - \mu_k)\}^2\)</span> is a safe, conservative variance
estimate.</p>
<p>M-estimation doesn’t help us to estimate <span class="math display">\[
\mathrm{Cov}\left\{
\sum_{i\in S} [\![A_i=k]\!] \check{w}_{i[k]} (y_{ki} - \mu_k),
\sum_{i\in S} [\![A_i=0]\!] \check{w}_{i[0]} (y_{0i} - \mu_0)
\right\}
\]</span> but these terms aren’t identified even for large strata with
multiple representatives of either condition. When interest is in the
difference <span class="math inline">\(\hat{\mu}_k -
\hat{\mu}_0\)</span>, conservatism leads us to ``impute’’ the covariance
value that maximizes the variance of that difference, that corresponding
to a correlation of 1 between <span class="math inline">\(\sum_{i\in S}
[\![A_i=k]\!] \check{w}_{i[k]}
(y_{ki} - \mu_k)\)</span> and <span class="math inline">\(\sum_{i\in S}
[\![A_i=0]\!] \check{w}_{i[0]} (y_{0i} -
\mu_0)\)</span>. We can follow the same principle when approaching the
problem from the perspective of <span class="math inline">\(M\)</span>-estimation, whatever the representation
of conditions <span class="math inline">\(k\)</span> and 0 within
stratum <span class="math inline">\(S\)</span>.</p>
<p>In separate hand-written notes I begin fleshing this out into methods
of estimating design-based second moments of first differences of the
estimating functions <span class="math inline">\(\eqref{eq:ee-hajekdiff}\)</span> that define the
Hajek estimators, which can in turn be used to approximate the
corresponding B-matrix terms; extending this work might be a suitable
problem for a PhD student.</p>
<p>%<!--For a stratum $S$ s.t. $\sum_{i \in S}  [\![A_i=k]\!] =  \sum_{i
%\in S} [\![A_i=0]\!]=1$, e.g. a matched pair in which conditions 0 and $k$ are represented.--></p>
<p>If covariate <span class="math inline">\(X\)</span> are included in a
linear regression specification with unit weights <span class="math inline">\(\sum_{j=1}^{K}\check{w}_{i[j]}[\![a_{i}=j]\!]\)</span>
— that is, the specification that without <span class="math inline">\(X\)</span> would have engendered estimation of
Hajek estimator differences as in <span class="math inline">\(\eqref{eq:ee-hajekdiff}\)</span> — then B-matrix
estimation can still be done just as it is without the covariates. The A
matrices are no longer diagonal, but are otherwise straightforward.
Combining estimates of these A and B matrices would give legitimate
standard errors for differences of Hajek estimators as before, but now
with adjustment for covariates.</p>
<p>%<!-- init segment of document shared w/ Xinhe W, early Feb22, ends here--></p>
<p>Another approach to covariates is to have fit their coefficients in a
separate and prior regression fit — perhaps a robust linear fit; or
perhaps a binary regression fit — and then to contrast Hajek aggregates
of residuals from these fits . This approach calls for stacked
estimating equations, with accompanying complications to both the A and
the B matrix. We might as well consider it in tandem with challenges
<span class="math inline">\(\ref{it:prob-differentstatuses}\)</span> and
<span class="math inline">\(\ref{it:prob-nonexperimentals-as-nonrandom}\)</span>.</p>
<p>To draw a distinction between experimental versus non-experimental
observations, let <span class="math inline">\(\mathcal{P}\)</span> be a
partition of a nonempty subset of <span class="math inline">\(\{1,
\ldots, n\}\)</span>, so that some but not necessarily all clusters 1,,
<span class="math inline">\(n\)</span> fall into some stratum <span class="math inline">\(S \in
\mathcal{P}\)</span>; these clusters are then the experimental or
quasi-experimental sample. Re-define <span class="math inline">\(\mathcal{Z}\)</span> to contain similar
information as above but also full information on clusters falling
outside of <span class="math inline">\(\mathcal{E} = \bigcap_{S \in
\mathcal{P}}S\)</span>: <span class="math display">\[\begin{equation}
\label{eq:Zdefextended}
  \mathcal{Z} = \sigma\left(\begin{array}{c}
                              \{(X_i, Y_{0i}, \ldots Y_{Ki}): i \in
                              \mathcal{E}\},
                              \{\sum_{i \in S}\, \![A_i=k\!] :
                              k \in \{0, \ldots, K\}; S  \in
\mathcal{P}\} , \\
                              \{(A_{i}, X_i, Y_{0i}, \ldots
                              Y_{Ki}): i \not\in\mathcal{E}\}
                              \end{array}\right).
\end{equation}\]</span> One now needs A and B matrices for estimating
functions of the Hajek estimator and the regression estimator
simultaneously. Given that we’re ultimately interested only to estimate
covariances for the Hajek differences, simplified expressions in terms
of A- and B-submatrices are available . Further simplification of B
matrices is possible given our conditioning on <span class="math inline">\(\mathcal{Z}\)</span> in <span class="math inline">\(\eqref{eq:Zdefextended}\)</span>; the B matrix
continues to be a sum of form~<span class="math inline">\(\eqref{eq:Bform}\)</span>, with clusters <span class="math inline">\(i\not\in \mathcal{E}\)</span> making no
contribution. (The design-based interpretation has no bearing on
calculation of <span class="math inline">\(A\)</span> matrices.)</p>
<!--
%%% Local Variables:
%%% mode: latex
%%% TeX-master: "design_based_SEs_"
%%% End:
-->
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Josh Errickson, Josh Wasserman, Ben Hansen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
