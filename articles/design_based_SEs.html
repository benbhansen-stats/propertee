<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Design based sandwich SEs for differences of Hajek estimators • propertee</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Design based sandwich SEs for differences of Hajek estimators">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">propertee</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.4.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Basic</h6></li>
    <li><a class="dropdown-item" href="../articles/intro-to-propertee.html">Introduction to propertee</a></li>
    <li><a class="dropdown-item" href="../articles/not-for-cran/mi_vignette/demo.html">Real-data demonstration with a finely stratified cluster RCT and a broader administrative database</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/non-binary-treatment.html">Non-binary Treatment Specification</a></li>
    <li><a class="dropdown-item" href="../articles/RDD.html">Regression Discontinuity Designs</a></li>
    <li><a class="dropdown-item" href="../articles/not-for-cran/geex_vs_propertee.html">propertee vs. geex</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Theory</h6></li>
    <li><a class="dropdown-item" href="../articles/sandwich_infrastructure.html">Data structures to support standard error calculations for direct adjustment assisted by a prior covariance model</a></li>
    <li><a class="dropdown-item" href="../articles/LinearModelVarianceEstimation.html">Variance Estimation Testing Using A Simple Linear Specification</a></li>
    <li><a class="dropdown-item" href="../articles/design_based_SEs.html">Design based sandwich SEs for differences of Hajek estimators</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/benbhansen-stats/propertee/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Design based sandwich SEs for differences of Hajek estimators</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/benbhansen-stats/propertee/blob/main/vignettes/design_based_SEs.Rmd" class="external-link"><code>vignettes/design_based_SEs.Rmd</code></a></small>
      <div class="d-none name"><code>design_based_SEs.Rmd</code></div>
    </div>

    
    
<p>We’ve promised to provide sandwich-type SEs for estimates of
treatment effect, with stacking of estimated equations as appropriate to
address possible use of separate regression fits to estimate covariance
adjustment terms and then to estimate marginal treatment effects. Often
``sandwich standard error’’ conjures an expectation of standard errors
that are model-based in the sense of assuming i.i.d. data
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>A</mi><mi>i</mi></msub><mo>,</mo><msub><mi>W</mi><mi>i</mi></msub><mo>,</mo><msub><mi>X</mi><mi>i</mi></msub><mo>,</mo><msub><mi>Y</mi><mrow><mn>0</mn><mi>i</mi></mrow></msub><mo>,</mo><mi>…</mi><msub><mi>Y</mi><mrow><mi>K</mi><mi>i</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(A_i,  W_{i}, X_i, Y_{0i}, \ldots Y_{Ki})</annotation></semantics></math>
and making inference conditional on the values of treatment assignments
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>∈</mo><mo stretchy="false" form="prefix">{</mo><mn>0</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>K</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">A \in
\{0, \ldots, K\}</annotation></semantics></math>, importance or
frequency weights
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>,
and covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>,
but not the values of potential responses
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><msub><mi>Y</mi><mi>k</mi></msub><mo>:</mo><mi>k</mi><mo>≤</mo><mi>K</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{Y_k: k \leq K\}</annotation></semantics></math>.
(This document takes
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
to range over intact clusters.) With the i.i.d assumption, these
model-based SEs are valid even if the design specification isn’t,
provided that the outcome model is well-specified. The role of the study
design is to provide analysis weights which, if respected, ensure
desired interpretations of marginal effect estimators if the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>-model
happens to be misspecified.</p>
<p>An alternative would be to offer sandwich standard errors under a
design-based interpretation, differing from the above principally in
terms of conditioning on</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝒵</mi><mo>=</mo><mi>σ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="false" form="prefix">{</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo>,</mo><msub><mi>Y</mi><mrow><mn>0</mn><mi>i</mi></mrow></msub><mo>,</mo><mi>…</mi><msub><mi>Y</mi><mrow><mi>K</mi><mi>i</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>:</mo><mi>i</mi><mo stretchy="false" form="postfix">}</mo><mo>,</mo><mo stretchy="false" form="prefix">{</mo><munder><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi>S</mi></mrow></munder><mspace width="0.167em"></mspace><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><mo>:</mo><mi>k</mi><mo>∈</mo><mo stretchy="false" form="prefix">{</mo><mn>0</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>K</mi><mo stretchy="false" form="postfix">}</mo><mo>;</mo><mi>S</mi><mo>∈</mo><mi>𝒫</mi><mo stretchy="false" form="postfix">}</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{Z} = \sigma(\{(X_i, Y_{0i}, \ldots Y_{Ki}): i\}, \{\sum_{i
    \in S}\, \![A_i=k\!] : k \in \{0, \ldots, K\}; S  \in \mathcal{P}\} )</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝒫</mi><annotation encoding="application/x-tex">\mathcal{P}</annotation></semantics></math>
is a given partition of {1,, n} encoding a stratification. Of particular
interest are standard errors for Hajek estimators, i.e. estimators of
form
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>μ</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">[</mo><mi>𝐯</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mfrac><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><msub><mi>v</mi><mi>i</mi></msub></mrow><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">\hat{\mu}_k[\mathbf{v}] = \frac{\sum_i \check{w}_{i[k]} [\![A_i=k]\!] v_i}{\sum_i \check{w}_{i[k]}  [\![A_i=k]\!]}</annotation></semantics></math>
and their differences
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>μ</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">[</mo><mi>𝐮</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>−</mo><msub><mover><mi>μ</mi><mo accent="true">̂</mo></mover><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">[</mo><mi>𝐯</mi><mo stretchy="true" form="postfix">]</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">\begin{equation}\label{eq:hajekdiff}
\hat{\mu}_k[\mathbf{u}] - \hat{\mu}_0[\mathbf{v}].
\end{equation}</annotation></semantics></math> The case weights
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mo>:</mo><mi>i</mi><mo>≤</mo><mi>n</mi><mo>,</mo><mi>k</mi><mo>≤</mo><mi>K</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{\check{w}_{i[k]}:i\leq n, k\leq K\}</annotation></semantics></math>
are the products of a frequency or importance weight
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mi>i</mi></msub><annotation encoding="application/x-tex">w_{i}</annotation></semantics></math>
and, as appopriate, a weighting factor representing a reciprocal of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>’s
probability (or odds) of assignment to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
(or to one of
{<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>,</mo><mi>…</mi><mo>,</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">k, \ldots,
K</annotation></semantics></math>}); in general differ by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>.
With
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>j</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">[</mo><mi>ℙ</mi><mo stretchy="false" form="prefix">(</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>j</mi><mo>∣</mo><mi>𝒵</mi><mo stretchy="true" form="postfix">]</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\check{w}_{i[j]} =[\mathbb{P}(A_{i}=j \mid \mathcal{Z}]^{-1}</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>=</mo><mn>0</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">j=0, \ldots, K</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>μ</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>𝐲</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo>−</mo><msub><mover><mi>μ</mi><mo accent="true">̂</mo></mover><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>𝐲</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{\mu}_k[\mathbf{y}_{k}] - \hat{\mu}_0[\mathbf{y}_{0}]</annotation></semantics></math>
is the natural estimate of the effect of treatment
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
within the experimental or quasiexperimental study sample,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>k</mi><mi>i</mi></mrow></msub><mo>−</mo><msub><mi>y</mi><mrow><mi>k</mi><mn>0</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">n^{-1}\sum_{i=1}^{n}(y_{ki}-y_{k0})</annotation></semantics></math>.
This is also known as the sample average treatment effect. If the
experimental observations are samples from a broader super-population,
with sample inclusion probabilities
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>π</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">\pi_{1}, \ldots, \pi_{n}</annotation></semantics></math>,
then setting
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>j</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mo>=</mo><msubsup><mi>π</mi><mi>i</mi><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><msup><mrow><mo stretchy="true" form="prefix">[</mo><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>j</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\check{w}_{i[j]} =\pi_{i}^{-1}[\mathbb{P}(A_{i}=j)]^{-1}</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>=</mo><mn>0</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">j=0, \ldots, K</annotation></semantics></math>
makes
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>μ</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>𝐲</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo>−</mo><msub><mover><mi>μ</mi><mo accent="true">̂</mo></mover><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>𝐲</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{\mu}_k[\mathbf{y}_{k}] - \hat{\mu}_0[\mathbf{y}_{0}]</annotation></semantics></math>
into the corresponding natural estimate of the population average
treatment effect.</p>
In one special case a design-based SE for has been available for some
time, with an optional interpretation in terms of M-estimation emerging
more recently. Suppose:
<p>In this case the variance estimate used in the 2 sample
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
test without pooling of variances validly estimates the variance of , in
the following sense. If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>v</mi><annotation encoding="application/x-tex">v</annotation></semantics></math>
is observed only when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">A=k</annotation></semantics></math>
while
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>u</mi><annotation encoding="application/x-tex">u</annotation></semantics></math>
is observed only when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">A=0</annotation></semantics></math>,
then
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mrow><mi>v</mi><mi>u</mi></mrow></msub><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>v</mi><mi>i</mi></msub><mo>−</mo><mover><mi>v</mi><mo accent="true">‾</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>u</mi><mi>i</mi></msub><mo>−</mo><mover><mi>v</mi><mo accent="true">‾</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">s_{vu} = (n-1)^{-1} \sum_{i=1}^n (v_i - \bar v)(u_i - \bar v)</annotation></semantics></math>
is not identified; as far as the data are concerned, it could lie
anywhere between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>±</mo><msub><mi>s</mi><mi>v</mi></msub><msub><mi>s</mi><mi>u</mi></msub></mrow><annotation encoding="application/x-tex">\pm s_{v} s_{u}</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>s</mi><mi>v</mi><mn>2</mn></msubsup><mo>=</mo><msub><mi>s</mi><mrow><mi>v</mi><mi>v</mi></mrow></msub><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>v</mi><mi>i</mi></msub><mo>−</mo><mover><mi>v</mi><mo accent="true">‾</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">s_{v}^2 = s_{vv} = (n-1)^{-1} \sum_{i=1}^n (v_i - \bar v)^2</annotation></semantics></math>.
Assuming
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mrow><mi>v</mi><mi>u</mi></mrow></msub><mo>=</mo><msub><mi>s</mi><mi>v</mi></msub><msub><mi>s</mi><mi>u</mi></msub></mrow><annotation encoding="application/x-tex">s_{vu} = s_{v}s_{u}</annotation></semantics></math>,
then the ordinary unpooled variance is unbiased for the design-based
variance (conditional variance given
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝒵</mi><annotation encoding="application/x-tex">\mathcal{Z}</annotation></semantics></math>)
of . If on the other hand
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mrow><mi>u</mi><mi>v</mi></mrow></msub><mo>≤</mo><msub><mi>s</mi><mi>v</mi></msub><msub><mi>s</mi><mi>u</mi></msub></mrow><annotation encoding="application/x-tex">s_{uv} \leq s_{v}s_{u}</annotation></semantics></math>,
then the expected value of this ordinary unpooled variance exceeds ’s
design-based variance . The possibilities
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mrow><mi>v</mi><mi>u</mi></mrow></msub><mo>=</mo><msub><mi>s</mi><mi>v</mi></msub><msub><mi>s</mi><mi>u</mi></msub></mrow><annotation encoding="application/x-tex">s_{vu} = s_{v}s_{u}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mrow><mi>v</mi><mi>u</mi></mrow></msub><mo>≤</mo><msub><mi>s</mi><mi>v</mi></msub><msub><mi>s</mi><mi>u</mi></msub></mrow><annotation encoding="application/x-tex">s_{vu} \leq s_{v}s_{u}</annotation></semantics></math>
being exhaustive, by Cauchy-Schwartz, the expected value of the unpooled
variance can be no less than
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">V</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>μ</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">[</mo><mi>𝐮</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>−</mo><msub><mover><mi>μ</mi><mo accent="true">̂</mo></mover><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">[</mo><mi>𝐯</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>∣</mo><mi>𝒵</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathrm{Var}(\hat{\mu}_k[\mathbf{u}] -
\hat{\mu}_0[\mathbf{v}] \mid \mathcal{Z})</annotation></semantics></math>;
it is valid as a possibly conservative estimate in that it cannot be
negatively biased.</p>
<p>As shown by , in this case the same variance estimate coincides with
the HC2 flavor of the Huber-White estimate. As a result, it’s sometimes
said that ordinary sandwich or cluster-robust variance estimates admit
of design-based interpretations provided that one uses the HC2 form. I
suspect this works only in special cases, however, perhaps not going far
beyond the one delimited above.</p>
<p>The use of the Neyman insight to get design-based SEs through
Huber-White covariance estimates intended for model-based interpretation
has several important limitations.</p>
The M-estimation framework promises solutions to many or all of these
impediments.
<p>The Hajek estimators
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>μ</mi><mo accent="true">̂</mo></mover><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>𝐲</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{\mu}_{0}[\mathbf{y}_{0}]</annotation></semantics></math>,
,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>μ</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>𝐲</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{\mu}_{k}[\mathbf{y}_{k}]</annotation></semantics></math>
admit of being defined as the unique multivariate root of the estimating
function
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><mn>0</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>μ</mi><mi>K</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>↦</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><munder><mo>∑</mo><mi>i</mi></munder><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>a</mi><mi>i</mi></msub><mo>=</mo><mi>K</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>K</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>K</mi><mi>i</mi></mrow></msub><mo>−</mo><msub><mi>μ</mi><mi>K</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>⋮</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><munder><mo>∑</mo><mi>i</mi></munder><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>a</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mn>0</mn><mi>i</mi></mrow></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">\begin{equation} \label{eq:ee-hajekdiff}
(\mu_{0}, \ldots, \mu_{K}) \mapsto
  \left[
\begin{array}{c}
\sum_i [\![a_i=K]\!] \check{w}_{i[K]} (y_{Ki} - \mu_K) \\
\vdots \\
\sum_i [\![a_i=0]\!] \check{w}_{i[0]} (y_{0i} - \mu_0) 
\end{array}
\right]
.
\end{equation}</annotation></semantics></math></p>
<p>The information matrices
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><mn>0</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>μ</mi><mi>K</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">A(\mu_0, \ldots, \mu_K)</annotation></semantics></math>
corresponding to are diagonal. For a sandwich estimate of variance,
then, we only need estimates of the covariance of~. In the one-stratum
case with multiple representatives of conditions
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>,
we can simply apply Neyman’s two-sample unpooled variances SE to
observations
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>k</mi><mi>i</mi></mrow></msub><mo>−</mo><msub><mi>μ</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>:</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{ \check{w}_{i[k]}
(y_{ki} - \mu_k) : A_i = k\}</annotation></semantics></math> and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mn>0</mn><mi>i</mi></mrow></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>:</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{ \check{w}_{i[0]} (y_{0i} - \mu_0) : A_i =
0\}</annotation></semantics></math>. Impediment~ is solved.</p>
<p>For standard errors of the difference of Hajek estimators within a
subgroup
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>g</mi><annotation encoding="application/x-tex">g</annotation></semantics></math>,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mo>,</mo><msub><mi>G</mi><mi>i</mi></msub><mo>=</mo><mi>g</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><msub><mi>y</mi><mrow><mi>k</mi><mi>i</mi></mrow></msub></mrow><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mo>,</mo><msub><mi>G</mi><mi>i</mi></msub><mo>=</mo><mi>g</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow></mrow></mfrac><mo>−</mo><mfrac><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn><mo>,</mo><msub><mi>G</mi><mi>i</mi></msub><mo>=</mo><mi>g</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><msub><mi>y</mi><mrow><mn>0</mn><mi>i</mi></mrow></msub></mrow><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn><mo>,</mo><msub><mi>G</mi><mi>i</mi></msub><mo>=</mo><mi>g</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow></mrow></mfrac><mo>,</mo></mrow><annotation encoding="application/x-tex">\begin{equation*}
 \frac{\sum_i \check{w}_{i[k]} [\![A_i=k, G_{i} =g]\!] y_{ki}}{\sum_i \check{w}_{i[k]}
     [\![A_i=k, G_{i}=g]\!]}
 -
  \frac{\sum_i \check{w}_{i[0]} [\![A_i=0, G_{i} =g]\!] y_{0i}}{\sum_i \check{w}_{i[0]}
     [\![A_i=0, G_{i}=g]\!]},
\end{equation*}</annotation></semantics></math> we can simply fold the
subgroup indicator into the weights, weighting by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><msub><mover><mi>w</mi><mo accent="true">̃</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>j</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mo>:</mo><mi>j</mi><mo>;</mo><mi>i</mi><mo stretchy="false" form="postfix">}</mo><mo>=</mo><mo stretchy="false" form="prefix">{</mo><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>j</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>G</mi><mi>i</mi></msub><mo>=</mo><mi>g</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><mo>:</mo><mi>j</mi><mo>;</mo><mi>i</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{\tilde{w}_{i[j]}:j; i\} = \{\check{w}_{i[j]}[\![G_{i}=g]\!]: j; i\}</annotation></semantics></math>
as opposed to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>j</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mo>:</mo><mi>j</mi><mo>;</mo><mi>i</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{\check{w}_{i[j]}:j;
i\}</annotation></semantics></math>. This solves the first part of
Impediment~.</p>
<p>(The remaining piece of Impediment~ is the need for estimates of
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">v</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><msub><mi>v</mi><mrow><mi>k</mi><mi>i</mi></mrow></msub></mrow><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow></mrow></mfrac><mo>−</mo><mfrac><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><msub><mi>v</mi><mrow><mn>0</mn><mi>i</mi></mrow></msub></mrow><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow></mrow></mfrac><mo>,</mo><mfrac><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>k</mi><mi>i</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><msub><mi>u</mi><mrow><mi>k</mi><mi>i</mi></mrow></msub></mrow><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>k</mi><mi>i</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow></mrow></mfrac><mo>−</mo><mfrac><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>k</mi><mi>i</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><msub><mi>u</mi><mrow><mn>0</mn><mi>i</mi></mrow></msub></mrow><mrow><munder><mo>∑</mo><mi>i</mi></munder><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>k</mi><mi>i</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation*}
  \mathrm{Cov}\left(
    \frac{\sum_i \check{w}_{i[k]} [\![A_i=k]\!] v_{ki}}{\sum_i \check{w}_{i[k]}
      [\![A_i=k]\!]} -
    \frac{\sum_i \check{w}_{i[k]} [\![A_i=k]\!] v_{0i}}{\sum_i \check{w}_{i[k]}  [\![A_i=k]\!]},
  \frac{\sum_i \check{w}_{ki} [\![A_i=k]\!] u_{ki}}{\sum_i \check{w}_{ki}
      [\![A_i=k]\!]} -
    \frac{\sum_i \check{w}_{ki} [\![A_i=k]\!] u_{0i}}{\sum_i \check{w}_{ki}  [\![A_i=k]\!]}
  \right)
\end{equation*}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>v</mi><mrow><mi>j</mi><mi>i</mi></mrow></msub><annotation encoding="application/x-tex">v_{ji}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>u</mi><mrow><mi>j</mi><mi>i</mi></mrow></msub><annotation encoding="application/x-tex">u_{ji}</annotation></semantics></math>
are observed only when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>j</mi></mrow><annotation encoding="application/x-tex">A_{i}=j</annotation></semantics></math>,
all
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>.
I haven’t had the opportunity to sit down and try to work this out, but
I’m optimistic that this can be handled with straightforward extensions
of the Neyman insight.)</p>
<p>Under the design-based interpretation, variances and covariances of
quantile regression estimating functions — for a quantile regression
with covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>c</mi><mi>i</mi></msub><annotation encoding="application/x-tex">c_{i}</annotation></semantics></math>
observations per cluster
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>↦</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>c</mi><mi>i</mi></msub></munderover><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>0</mn></mrow><mi>K</mi></munderover><msub><mi>x</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>y</mi><mrow><mi>k</mi><mi>i</mi><mi>j</mi></mrow></msub><mo>−</mo><msub><mi>X</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mi>′</mi><mi>β</mi><mo>,</mo><msub><mi>a</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mo stretchy="false" form="postfix">)</mo><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><mo>−</mo><mi>τ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation*}
\beta \mapsto  \sum_{i=1}^{n}\sum_{j=1}^{c_{i}}\sum_{k=0}^{K} x_{ij}([\![y_{kij} -
  X_{ij}'\beta, a_{i}= k)]\!] - \tau)
\end{equation*}</annotation></semantics></math> — are likely to be
estimable in much the same way as variances and covariances of
estimating functions for other forms of regression. In any case, there
will be no need for estimation of a sparsity parameter. The impediment
is removed.</p>
<p>(Quantile regression doesn’t bear any of its usual interpretations
under conditioning on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝒵</mi><annotation encoding="application/x-tex">\mathcal{Z}</annotation></semantics></math>,
but that doesn’t matter for purposes of using it to estimate slopes in
an RDD.)</p>
<p>Now consider Impediment~, strata
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>S</mi><annotation encoding="application/x-tex">S</annotation></semantics></math>
in which one or both of the conditions
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
being contrasted have only one representative,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi>S</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>j</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sum_{i\in S} [\![A_{i}=j]\!] =1</annotation></semantics></math>.
Consider the situation without covariates.</p>
<p>As there is independence across if not within strata, the B matrices
corresponding to~ are sums of stratum-wise contributions
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mi>S</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><mn>0</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>μ</mi><mi>K</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">v</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><munder><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi>S</mi></mrow></munder><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>K</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>K</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>K</mi><mi>i</mi></mrow></msub><mo>−</mo><msub><mi>μ</mi><mi>K</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>⋮</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><munder><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi>S</mi></mrow></munder><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mn>0</mn><mi>i</mi></mrow></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mo>∣</mo><mi>𝒵</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mi>S</mi><mo>∈</mo><mi>𝒫</mi><mi>.</mi></mrow><annotation encoding="application/x-tex">\begin{equation} \label{eq:Bform}
B_S((\mu_0, \ldots, \mu_K)) =
\mathrm{Cov}\left(\left[
\begin{array}{c}
\sum_{i\in S} [\![A_i=K]\!] \check{w}_{i[K]} (y_{Ki} - \mu_K) \\
\vdots \\
\sum_{i\in S} [\![A_i=0]\!] \check{w}_{i[0]} (y_{0i} - \mu_0)
\end{array}
\right] \mid \mathcal{Z}\right), \quad S \in \mathcal{P}.
\end{equation}</annotation></semantics></math> For any stratum
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>S</mi><annotation encoding="application/x-tex">S</annotation></semantics></math>
and condition
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
s.t.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi>S</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sum_{i \in S}  [\![A_i=k]\!] =1</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">V</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">r</mi></mrow><mrow><mo stretchy="true" form="prefix">{</mo><msub><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi>S</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>k</mi><mi>i</mi></mrow></msub><mo>−</mo><msub><mi>μ</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">}</mo></mrow></mrow><annotation encoding="application/x-tex">\mathrm{Var}\left\{ \sum_{i\in S} [\![A_i=k]\!] \check{w}_{i[k]} (y_{ki} - \mu_k) \right\}</annotation></semantics></math>
is not estimable, just as the variance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow><mo stretchy="true" form="prefix">[</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>#</mi><mi>S</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><msub><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi>S</mi></mrow></msub><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>k</mi><mi>i</mi></mrow></msub><mo>−</mo><msub><mover><mi>y</mi><mo accent="true">‾</mo></mover><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">[(\# S)-1]^{-1}\sum_{i \in S} (y_{ki} - \bar{y}_k)^2</annotation></semantics></math>
is not estimable. On the other hand, the second moment
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝔼</mi><mrow><mo stretchy="true" form="prefix">[</mo><msup><mrow><mo stretchy="true" form="prefix">{</mo><munder><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi>S</mi></mrow></munder><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>k</mi><mi>i</mi></mrow></msub><mo>−</mo><msub><mi>μ</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">}</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex"> \mathbb{E}\left[\left\{ \sum_{i\in S} [\![A_i=k]\!] \check{w}_{i[k]} (y_{ki} - \mu_k) \right\}^2\right]
</annotation></semantics></math> estimable, by it sample realization
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mrow><mo stretchy="true" form="prefix">{</mo><msub><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi>S</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>a</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>k</mi><mi>i</mi></mrow></msub><mo>−</mo><msub><mi>μ</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">}</mo></mrow><mn>2</mn></msup><annotation encoding="application/x-tex">\left\{ \sum_{i\in
    S} [\![a_i=k]\!] \check{w}_{i[k]} (y_{ki} - \mu_k) \right\}^2</annotation></semantics></math>:
in M-estimation, we’re entitled to treat
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\mu_k</annotation></semantics></math>
is a fixed constant, not a random variable. Since the second moment
bounds the variance from above,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><msub><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi>S</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>k</mi><mi>i</mi></mrow></msub><mo>−</mo><msub><mi>μ</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><msup><mo stretchy="false" form="postfix">}</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\{\sum_{i\in S} [\![A_i=k]\!] \check{w}_{i[k]} (y_{ki} - \mu_k)\}^2</annotation></semantics></math>
is a safe, conservative variance estimate.</p>
<p>M-estimation doesn’t help us to estimate
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">v</mi></mrow><mrow><mo stretchy="true" form="prefix">{</mo><munder><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi>S</mi></mrow></munder><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>k</mi><mi>i</mi></mrow></msub><mo>−</mo><msub><mi>μ</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><munder><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi>S</mi></mrow></munder><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mn>0</mn><mi>i</mi></mrow></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">}</mo></mrow></mrow><annotation encoding="application/x-tex">
\mathrm{Cov}\left\{
\sum_{i\in S} [\![A_i=k]\!] \check{w}_{i[k]} (y_{ki} - \mu_k),
\sum_{i\in S} [\![A_i=0]\!] \check{w}_{i[0]} (y_{0i} - \mu_0)
\right\}
</annotation></semantics></math> but these terms aren’t identified even
for large strata with multiple representatives of either condition. When
interest is in the difference
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>μ</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><mo>−</mo><msub><mover><mi>μ</mi><mo accent="true">̂</mo></mover><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">\hat{\mu}_k - \hat{\mu}_0</annotation></semantics></math>,
conservatism leads us to ``impute’’ the covariance value that maximizes
the variance of that difference, that corresponding to a correlation of
1 between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi>S</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>k</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>k</mi><mi>i</mi></mrow></msub><mo>−</mo><msub><mi>μ</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\sum_{i\in S} [\![A_i=k]\!] \check{w}_{i[k]}
(y_{ki} - \mu_k)</annotation></semantics></math> and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi>S</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mn>0</mn><mi>i</mi></mrow></msub><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\sum_{i\in S} [\![A_i=0]\!] \check{w}_{i[0]} (y_{0i} -
\mu_0)</annotation></semantics></math>. We can follow the same principle
when approaching the problem from the perspective of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>M</mi><annotation encoding="application/x-tex">M</annotation></semantics></math>-estimation,
whatever the representation of conditions
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
and 0 within stratum
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>S</mi><annotation encoding="application/x-tex">S</annotation></semantics></math>.</p>
<p>In separate hand-written notes I begin fleshing this out into methods
of estimating design-based second moments of first differences of the
estimating functions that define the Hajek estimators, which can in turn
be used to approximate the corresponding B-matrix terms; extending this
work might be a suitable problem for a PhD student.</p>
<p>%<!--For a stratum $S$ s.t. $\sum_{i \in S}  [\![A_i=k]\!] =  \sum_{i
%\in S} [\![A_i=0]\!]=1$, e.g. a matched pair in which conditions 0 and $k$ are represented.--></p>
<p>If covariate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
are included in a linear regression specification with unit weights
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></msubsup><msub><mover><mi>w</mi><mo accent="true">̌</mo></mover><mrow><mi>i</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>j</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mrow><mo stretchy="true" form="prefix">[</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>a</mi><mi>i</mi></msub><mo>=</mo><mi>j</mi><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\sum_{j=1}^{K}\check{w}_{i[j]}[\![a_{i}=j]\!]</annotation></semantics></math>
— that is, the specification that without
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
would have engendered estimation of Hajek estimator differences as in —
then B-matrix estimation can still be done just as it is without the
covariates. The A matrices are no longer diagonal, but are otherwise
straightforward. Combining estimates of these A and B matrices would
give legitimate standard errors for differences of Hajek estimators as
before, but now with adjustment for covariates.</p>
<p>%<!-- init segment of document shared w/ Xinhe W, early Feb22, ends here--></p>
<p>Another approach to covariates is to have fit their coefficients in a
separate and prior regression fit — perhaps a robust linear fit; or
perhaps a binary regression fit — and then to contrast Hajek aggregates
of residuals from these fits . This approach calls for stacked
estimating equations, with accompanying complications to both the A and
the B matrix. We might as well consider it in tandem with challenges and
.</p>
<p>To draw a distinction between experimental versus non-experimental
observations, let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝒫</mi><annotation encoding="application/x-tex">\mathcal{P}</annotation></semantics></math>
be a partition of a nonempty subset of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><mn>1</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>n</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{1, \ldots, n\}</annotation></semantics></math>,
so that some but not necessarily all clusters 1,,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
fall into some stratum
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>∈</mo><mi>𝒫</mi></mrow><annotation encoding="application/x-tex">S \in
\mathcal{P}</annotation></semantics></math>; these clusters are then the
experimental or quasi-experimental sample. Re-define
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝒵</mi><annotation encoding="application/x-tex">\mathcal{Z}</annotation></semantics></math>
to contain similar information as above but also full information on
clusters falling outside of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℰ</mi><mo>=</mo><msub><mo>⋂</mo><mrow><mi>S</mi><mo>∈</mo><mi>𝒫</mi></mrow></msub><mi>S</mi></mrow><annotation encoding="application/x-tex">\mathcal{E} = \bigcap_{S \in \mathcal{P}}S</annotation></semantics></math>:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝒵</mi><mo>=</mo><mi>σ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mo stretchy="false" form="prefix">{</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>i</mi></msub><mo>,</mo><msub><mi>Y</mi><mrow><mn>0</mn><mi>i</mi></mrow></msub><mo>,</mo><mi>…</mi><msub><mi>Y</mi><mrow><mi>K</mi><mi>i</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>:</mo><mi>i</mi><mo>∈</mo><mi>ℰ</mi><mo stretchy="false" form="postfix">}</mo><mo>,</mo><mo stretchy="false" form="prefix">{</mo><munder><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><mi>S</mi></mrow></munder><mspace width="0.167em"></mspace><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mspace width="-0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><mo>:</mo><mi>k</mi><mo>∈</mo><mo stretchy="false" form="prefix">{</mo><mn>0</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>K</mi><mo stretchy="false" form="postfix">}</mo><mo>;</mo><mi>S</mi><mo>∈</mo><mi>𝒫</mi><mo stretchy="false" form="postfix">}</mo><mo>,</mo></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mo stretchy="false" form="prefix">{</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>A</mi><mi>i</mi></msub><mo>,</mo><msub><mi>X</mi><mi>i</mi></msub><mo>,</mo><msub><mi>Y</mi><mrow><mn>0</mn><mi>i</mi></mrow></msub><mo>,</mo><mi>…</mi><msub><mi>Y</mi><mrow><mi>K</mi><mi>i</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>:</mo><mi>i</mi><mo>∉</mo><mi>ℰ</mi><mo stretchy="false" form="postfix">}</mo></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">\begin{equation} \label{eq:Zdefextended}
  \mathcal{Z} = \sigma\left(\begin{array}{c}
                              \{(X_i, Y_{0i}, \ldots Y_{Ki}): i \in
                              \mathcal{E}\},
                              \{\sum_{i \in S}\, \![A_i=k\!] :
                              k \in \{0, \ldots, K\}; S  \in \mathcal{P}\} , \\
                              \{(A_{i}, X_i, Y_{0i}, \ldots
                              Y_{Ki}): i \not\in\mathcal{E}\}
                              \end{array}\right).
\end{equation}</annotation></semantics></math> One now needs A and B
matrices for estimating functions of the Hajek estimator and the
regression estimator simultaneously. Given that we’re ultimately
interested only to estimate covariances for the Hajek differences,
simplified expressions in terms of A- and B-submatrices are available .
Further simplification of B matrices is possible given our conditioning
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝒵</mi><annotation encoding="application/x-tex">\mathcal{Z}</annotation></semantics></math>
in ; the B matrix continues to be a sum of form~, with clusters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>∉</mo><mi>ℰ</mi></mrow><annotation encoding="application/x-tex">i\not\in \mathcal{E}</annotation></semantics></math>
making no contribution. (The design-based interpretation has no bearing
on calculation of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
matrices.)</p>
<!--
%%% Local Variables:
%%% mode: latex
%%% TeX-master: "design_based_SEs_"
%%% End:
-->
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Josh Errickson, Josh Wasserman, Ben Hansen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
