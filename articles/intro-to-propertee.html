<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to propertee • propertee</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to propertee">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">propertee</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.4.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Basic</h6></li>
    <li><a class="dropdown-item" href="../articles/intro-to-propertee.html">Introduction to propertee</a></li>
    <li><a class="dropdown-item" href="../articles/not-for-cran/mi_vignette/demo.html">Real-data demonstration with a finely stratified cluster RCT and a broader administrative database</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/non-binary-treatment.html">Non-binary Treatment Specification</a></li>
    <li><a class="dropdown-item" href="../articles/RDD.html">Regression Discontinuity Designs</a></li>
    <li><a class="dropdown-item" href="../articles/not-for-cran/geex_vs_propertee.html">propertee vs. geex</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Theory</h6></li>
    <li><a class="dropdown-item" href="../articles/sandwich_infrastructure.html">Data structures to support standard error calculations for direct adjustment assisted by a prior covariance model</a></li>
    <li><a class="dropdown-item" href="../articles/LinearModelVarianceEstimation.html">Variance Estimation Testing Using A Simple Linear Specification</a></li>
    <li><a class="dropdown-item" href="../articles/design_based_SEs.html">Design based sandwich SEs for differences of Hajek estimators</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/benbhansen-stats/propertee/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to propertee</h1>
                        <h4 data-toc-skip class="author">propertee
Authors</h4>
            
            <h4 data-toc-skip class="date">2024-09-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/benbhansen-stats/propertee/blob/main/vignettes/intro-to-propertee.Rmd" class="external-link"><code>vignettes/intro-to-propertee.Rmd</code></a></small>
      <div class="d-none name"><code>intro-to-propertee.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="main-features">Main Features<a class="anchor" aria-label="anchor" href="#main-features"></a>
</h2>
<p>The <strong>propertee</strong> package, Prognostic Regression Offsets
with Propagation of ERrors (for Treatment Effect Estimation),
facilitates direct adjustment for experiments and observational studies
with design-informed standard errors and flexible options for covariance
adjustment. It uses explicit specification of study design to provide
probability of assignment weights and standard errors that appropriately
reflect the design. For covariance adjustment of its Hajek and (one-way)
fixed effects estimates, it enables offsetting the outcome against
predictions from a dedicated covariance model, with standard error
calculations propagating error as appropriate from the covariance
model.</p>
<p>The main workflow consists of two main steps and one optional
step:</p>
<ol style="list-style-type: decimal">
<li>Generate a <code>Design</code> object which encodes the study
design, including the unit of assignment, treatment status of each unit
of assignment, and optionally block information. This is accomplished
with the <code><a href="../reference/Design_objects.html">obs_design()</a></code>, <code><a href="../reference/Design_objects.html">rct_design()</a></code> or
<code><a href="../reference/Design_objects.html">rd_design()</a></code> functions.</li>
<li>Optionally, fit a covariate adjustment model.</li>
<li>Fit a model to estimate a treatment effect, accounting for the
design information, and optionally the covariate adjustment. This is
done via the <code><a href="../reference/lmitt.html">lmitt()</a></code> function.</li>
</ol>
</div>
<div class="section level2">
<h2 id="example-data">Example Data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<p>The example dataset comes from the state of Tennessee’s
Student-Teacher Achievement Ratio (STAR) experiment. Students were
randomly assigned to three possible classroom conditions: small (13 to
17 students per teacher), regular class (22 to 25 students per teacher),
and regular-with-aide class (22 to 25 students with a full-time
teacher’s aide).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">STARdata</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">STARdata</span><span class="op">$</span><span class="va">stark</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      regular        small regular+aide </span></span>
<span><span class="co">#&gt;         2194         1900         2231</span></span></code></pre></div>
<p>For simplicity for this first example, we will examine a single
binary treatment - “small” classrooms versus “regular” and
“regular+aide” classrooms.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">STARdata</span><span class="op">$</span><span class="va">starkbinary</span> <span class="op">&lt;-</span> <span class="va">STARdata</span><span class="op">$</span><span class="va">stark</span> <span class="op">==</span> <span class="st">"small"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">STARdata</span><span class="op">$</span><span class="va">starkbinary</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; FALSE  TRUE </span></span>
<span><span class="co">#&gt;  4425  1900</span></span></code></pre></div>
<p>After this basic example, we will see how <strong>propertee</strong>
makes it easy to handle non-binary treatment variables by introducing
<code>dichotomy</code>s.</p>
<p>The outcome of interest is a reading score at the end of
kindergarten.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">STARdata</span><span class="op">$</span><span class="va">readk</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span><span class="co">#&gt;   315.0   414.0   433.0   436.7   453.0   627.0    5809</span></span></code></pre></div>
<p>The students were blocked into schools via the <code>schoolidk</code>
variable:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">STARdata</span><span class="op">$</span><span class="va">schoolidk</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 80</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">STARdata</span><span class="op">$</span><span class="va">schoolidk</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   1   2   3   4   5   6 </span></span>
<span><span class="co">#&gt;  74  54 100  60  61  54</span></span></code></pre></div>
<p>Students were the assigned units, so we need a unique identifier per
student. If this does not currently exist, it can easily be
generated:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">STARdata</span><span class="op">$</span><span class="va">studentid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">STARdata</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">STARdata</span><span class="op">$</span><span class="va">studentid</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1 2 3 4 5 6</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="a-basic-example">A Basic Example<a class="anchor" aria-label="anchor" href="#a-basic-example"></a>
</h2>
<div class="section level3">
<h3 id="defining-the-design">Defining the <code>Design</code><a class="anchor" aria-label="anchor" href="#defining-the-design"></a>
</h3>
<p>The three <code>_design</code> functions (<code><a href="../reference/Design_objects.html">rct_design()</a></code>,
<code>obj_design()</code>, and <code><a href="../reference/Design_objects.html">rd_design()</a></code>) operate
similarly. The first argument is the most important, and encodes all the
design information through the use of a formula. The left-hand side of
the formula identifies the treatment variable. The right-hand side of
the formula consists of the following potential pieces of
information:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="../reference/DesignSpecials.html">unit_of_assignment()</a></code>: This identifies the variable(s)
which indicate the units of assignment. This is required for all
designs. The alias <code><a href="../reference/DesignSpecials.html">uoa()</a></code> can be used in its place.</li>
<li>
<code><a href="../reference/DesignSpecials.html">block()</a></code>: The identifies the variable(s) which contain
block information. Optional.</li>
<li>
<code><a href="../reference/DesignSpecials.html">forcing()</a></code>: In regression discontinuity designs
(<code><a href="../reference/Design_objects.html">rd_design()</a></code>), this identifies the variable(s) which
contain forcing information.</li>
</ol>
<p>To define a <code>Design</code> in our example:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">des</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Design_objects.html">obs_design</a></span><span class="op">(</span><span class="va">starkbinary</span> <span class="op">~</span> <span class="fu"><a href="../reference/DesignSpecials.html">unit_of_assignment</a></span><span class="op">(</span><span class="va">studentid</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/DesignSpecials.html">block</a></span><span class="op">(</span><span class="va">schoolidk</span><span class="op">)</span>,</span>
<span>                  data <span class="op">=</span> <span class="va">STARdata</span>, na.fail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">des</span><span class="op">)</span></span>
<span><span class="co">#&gt; Observational Study</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Structure          Variables  </span></span>
<span><span class="co">#&gt;  ---------          ---------  </span></span>
<span><span class="co">#&gt;  Treatment          starkbinary</span></span>
<span><span class="co">#&gt;  Unit of Assignment studentid  </span></span>
<span><span class="co">#&gt;  Block              schoolidk  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of units per Treatment group: </span></span>
<span><span class="co">#&gt;  Txt Grp Num Units</span></span>
<span><span class="co">#&gt;    FALSE      4425</span></span>
<span><span class="co">#&gt;     TRUE      1900</span></span></code></pre></div>
<p>Should more than one variable be needed to identify the unit of
assignment, block, or forcing, they can be included. For example,
perhaps <code>schoolidk</code> may be unique within district, but
potentially not unique across districts. Then we’d use something like
<code>block(districtid, schoolidk)</code> in the <code>_design</code>
function.</p>
</div>
<div class="section level3">
<h3 id="estimating-the-treatment-effect">Estimating the treatment effect<a class="anchor" aria-label="anchor" href="#estimating-the-treatment-effect"></a>
</h3>
<p>The main function for estimating treatment effects is the
<code><a href="../reference/lmitt.html">lmitt()</a></code> function. It takes in three main required
arguments:</p>
<ol style="list-style-type: decimal">
<li>A formula specifying the outcome and the desired treatment
effect.</li>
<li>The data set containing the outcome information.</li>
<li>A <a href="#defining-the-design"><code>Design</code></a>.</li>
</ol>
<p>Note that the data set does <strong>not</strong> need to be the same
data set which generated the <code>Design</code>; it does however need
to include the same variables to identify the units of assignment. (If
the variable names differ, the <code>by=</code> argument can be used to
link them, though we recommend renaming to reduce the likelihood of
issues.)</p>
<p>For example, you may have one dataset containing school-level
information, and a separate dataset containing student-level
information. Assume school is the unit of assignment. While you could of
course merge those two data-sets, <strong>propertee</strong> can instead
use the school-level data to define the <code>Design</code>, and the
student-level data to estimate the treatment effect.</p>
<p>The formula entering <code><a href="../reference/lmitt.html">lmitt()</a></code> can take on one of two
forms:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">~</span> <span class="fl">1</span></span></code></pre></div>
<p>will estimate the main treatment effect on outcome variable
<code>y</code>, and</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span></span></code></pre></div>
<p>will estimate subgroup specific treatment effects for each level of
<code>x</code> for the outcome <code>y</code>, if <code>x</code> is
categorical. For continuous <code>x</code>, a main effect and a
treatment-<code>x</code> interaction effect is estimated.</p>
<p>Therefore, to estimate the treatment effect in our example, we can
run:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">te</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lmitt.html">lmitt</a></span><span class="op">(</span><span class="va">readk</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">STARdata</span>, design <span class="op">=</span> <span class="va">des</span><span class="op">)</span></span>
<span><span class="co">#&gt; The Design object contains block-level information, but it is not used in this model. Block information is used when weights are defined via `ate()` or `ett()` or if the `absorb=TRUE` argument is passed.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">te</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lmitt(readk ~ 1, data = STARdata, design = des)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Treatment Effects :</span></span>
<span><span class="co">#&gt;                  Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; starkbinary.TRUE   5.4632     0.9207   5.934 3.13e-09 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Std. Error calculated via type "CR0"</span></span></code></pre></div>
<p>The data includes ethnicity; we can estimate subgroup effects by
ethnicity:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">te_s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lmitt.html">lmitt</a></span><span class="op">(</span><span class="va">readk</span> <span class="op">~</span> <span class="va">ethnicity</span>, data <span class="op">=</span> <span class="va">STARdata</span>, design <span class="op">=</span> <span class="va">des</span><span class="op">)</span></span>
<span><span class="co">#&gt; The Design object contains block-level information, but it is not used in this model. Block information is used when weights are defined via `ate()` or `ett()` or if the `absorb=TRUE` argument is passed.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">te_s</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: The following subgroups do not have sufficient degrees of freedom for</span></span>
<span><span class="co">#&gt; standard error estimates and will be returned as NA: ethnicityamindian</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lmitt(readk ~ ethnicity, data = STARdata, design = des)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Treatment Effects :</span></span>
<span><span class="co">#&gt;                                    Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; starkbinary.TRUE_ethnicitycauc        4.717      1.147   4.112 3.97e-05 ***</span></span>
<span><span class="co">#&gt; starkbinary.TRUE_ethnicityafam        6.607      1.468   4.500 6.94e-06 ***</span></span>
<span><span class="co">#&gt; starkbinary.TRUE_ethnicityasian      -9.939     21.021  -0.473   0.6364    </span></span>
<span><span class="co">#&gt; starkbinary.TRUE_ethnicityhispanic   35.667     18.635   1.914   0.0557 .  </span></span>
<span><span class="co">#&gt; starkbinary.TRUE_ethnicityamindian   19.000         NA      NA       NA    </span></span>
<span><span class="co">#&gt; starkbinary.TRUE_ethnicityother      13.333     26.857   0.496   0.6196    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Std. Error calculated via type "CR0"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="including-design-weights">Including design weights<a class="anchor" aria-label="anchor" href="#including-design-weights"></a>
</h3>
<p>Design weights can be easily included in this estimation.
<strong>propertee</strong> supports average treatment effect (ATE) and
effect of the treatment on the treated (ETT) weights.</p>
<p>To include one of the weights, simply include the
<code>weights = "ate"</code> or <code>weights = "ett"</code> argument to
<code><a href="../reference/lmitt.html">lmitt()</a></code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lmitt.html">lmitt</a></span><span class="op">(</span><span class="va">readk</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">STARdata</span>, design <span class="op">=</span> <span class="va">des</span>, weights <span class="op">=</span> <span class="st">"ate"</span><span class="op">)</span></span>
<span><span class="co">#&gt; starkbinary.TRUE </span></span>
<span><span class="co">#&gt;         6.116683</span></span>
<span><span class="fu"><a href="../reference/lmitt.html">lmitt</a></span><span class="op">(</span><span class="va">readk</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">STARdata</span>, design <span class="op">=</span> <span class="va">des</span>, weights <span class="op">=</span> <span class="st">"ett"</span><span class="op">)</span></span>
<span><span class="co">#&gt; starkbinary.TRUE </span></span>
<span><span class="co">#&gt;         5.650771</span></span></code></pre></div>
<p>Internally, these call the <code><a href="../reference/WeightCreators.html">ate()</a></code> or <code><a href="../reference/WeightCreators.html">ett()</a></code>
functions which can be used directly.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/WeightCreators.html">ate</a></span><span class="op">(</span><span class="va">des</span>, data <span class="op">=</span> <span class="va">STARdata</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.000000 3.965517 4.705882 0.000000 1.445946 0.000000</span></span></code></pre></div>
<p>When included inside <code><a href="../reference/lmitt.html">lmitt()</a></code>, you do not need to specify
any additional arguments to <code><a href="../reference/WeightCreators.html">ate()</a></code> or <code><a href="../reference/WeightCreators.html">ett()</a></code>,
enabling easy functions of weights. For example if you had some other
weight variable, say <code>wgt</code>, you could include
<code>weights = wgt*ate()</code> in the <code><a href="../reference/lmitt.html">lmitt()</a></code> call.</p>
</div>
<div class="section level3">
<h3 id="covariance-adjustment-models">Covariance Adjustment models<a class="anchor" aria-label="anchor" href="#covariance-adjustment-models"></a>
</h3>
<p>By itself, <code><a href="../reference/lmitt.html">lmitt()</a></code> does not allow for other covariates;
e.g. something like <code>lmitt(y ~ 1 + control_var,...</code> will
fail. To adjust for covariates, a separate covariate model should be
fit. Any model which supports a <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> function should
work.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">camod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">readk</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">birth</span> <span class="op">+</span> <span class="va">lunchk</span>, data <span class="op">=</span> <span class="va">STARdata</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/cov_adj.html">cov_adj()</a></code> function can be used to process the
covariance adjustment model and produce the required values; and its
output can be passed as an <code>offset=</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lmitt.html">lmitt</a></span><span class="op">(</span><span class="va">readk</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">STARdata</span>, design <span class="op">=</span> <span class="va">des</span>,</span>
<span>      weights <span class="op">=</span> <span class="st">"ate"</span>, offset <span class="op">=</span> <span class="fu"><a href="../reference/cov_adj.html">cov_adj</a></span><span class="op">(</span><span class="va">camod</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in validityMethod(object): Some covariance adjustments are NA; be</span></span>
<span><span class="co">#&gt; careful of dropping these observations when fitting the ITT effect model</span></span>
<span><span class="co">#&gt; starkbinary.TRUE </span></span>
<span><span class="co">#&gt;         6.050889</span></span></code></pre></div>
<p>Similarly to the weight functions, <code><a href="../reference/cov_adj.html">cov_adj()</a></code> attempts to
locate the correct arguments (in this case, mainly the
<code>data=</code> argument) to use in the model command; while
<code><a href="../reference/cov_adj.html">cov_adj()</a></code> does fall back to using the data which is in the
covariance model, its safer to use the <code>newdata=</code> argument if
calling <code><a href="../reference/cov_adj.html">cov_adj()</a></code> outside of the model.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/cov_adj.html">cov_adj</a></span><span class="op">(</span><span class="va">camod</span>, newdata <span class="op">=</span> <span class="va">STARdata</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]       NA 448.8500 450.2802       NA 425.4395       NA</span></span></code></pre></div>
<p>Also, similarly to weights, <code><a href="../reference/cov_adj.html">cov_adj()</a></code> can be used in
normal modeling commands as well.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">readk</span> <span class="op">~</span> <span class="va">starkbinary</span>, data <span class="op">=</span> <span class="va">STARdata</span>, weights <span class="op">=</span> <span class="fu"><a href="../reference/WeightCreators.html">ate</a></span><span class="op">(</span><span class="va">des</span><span class="op">)</span>,</span>
<span>   offset <span class="op">=</span> <span class="fu"><a href="../reference/cov_adj.html">cov_adj</a></span><span class="op">(</span><span class="va">camod</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in validityMethod(object): Some covariance adjustments are NA; be</span></span>
<span><span class="co">#&gt; careful of dropping these observations when fitting the ITT effect model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = readk ~ starkbinary, data = STARdata, weights = ate(des), </span></span>
<span><span class="co">#&gt;     offset = cov_adj(camod))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;     (Intercept)  starkbinaryTRUE  </span></span>
<span><span class="co">#&gt;          -1.684            6.051</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="absorbing-blocks">Absorbing Blocks<a class="anchor" aria-label="anchor" href="#absorbing-blocks"></a>
</h3>
<p>If fixed effects for blocks are desired, which can be absorbed away
to avoid estimating, the <code>absorb=TRUE</code> argument can be
passed.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lmitt.html">lmitt</a></span><span class="op">(</span><span class="va">readk</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">STARdata</span>, design <span class="op">=</span> <span class="va">des</span>, absorb <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; starkbinary.TRUE </span></span>
<span><span class="co">#&gt;          5.14933</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Josh Errickson, Josh Wasserman, Ben Hansen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
