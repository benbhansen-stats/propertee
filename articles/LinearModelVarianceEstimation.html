<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Variance Estimation Testing Using A Simple Linear Specification • propertee</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Variance Estimation Testing Using A Simple Linear Specification">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">propertee</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.4.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Basic</h6></li>
    <li><a class="dropdown-item" href="../articles/intro-to-propertee.html">Introduction to propertee</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/not-for-cran/mi_vignette/demo.html">Real-data demonstration with a finely stratified cluster RCT and a broader administrative database</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/non-binary-treatment.html">Non-binary Treatment Specification</a></li>
    <li><a class="dropdown-item" href="../articles/RDD.html">Regression Discontinuity Designs</a></li>
    <li><a class="dropdown-item" href="../articles/not-for-cran/geex_vs_propertee.html">propertee vs. geex</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Theory</h6></li>
    <li><a class="dropdown-item" href="../articles/sandwich_infrastructure.html">Data structures to support standard error calculations for direct adjustment assisted by a prior covariance model</a></li>
    <li><a class="dropdown-item" href="../articles/LinearModelVarianceEstimation.html">Variance Estimation Testing Using A Simple Linear Specification</a></li>
    <li><a class="dropdown-item" href="../articles/design_based_SEs.html">Design based sandwich SEs for differences of Hajek estimators</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/benbhansen-stats/propertee/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Variance Estimation Testing Using A Simple Linear Specification</h1>
                        <h4 data-toc-skip class="author">Mark
Fredrickson, Ben Hansen</h4>
            
            <h4 data-toc-skip class="date">2023-03-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/benbhansen-stats/propertee/blob/main/vignettes/LinearModelVarianceEstimation.Rmd" class="external-link"><code>vignettes/LinearModelVarianceEstimation.Rmd</code></a></small>
      <div class="d-none name"><code>LinearModelVarianceEstimation.Rmd</code></div>
    </div>

    
    
<p>The goal of this document is to consider a simple model that can be
arranged as two separate regressions and relate the variance of the
second stage coefficients to those that are fit in the entire model.
With this information, we should be able to create tests of our variance
estimation routines.</p>
<div class="section level2">
<h2 id="combined-model">Combined model<a class="anchor" aria-label="anchor" href="#combined-model"></a>
</h2>
<p>Consider two sets of background variables and treatment assignments,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>
with dimension
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>x</mi></msub><annotation encoding="application/x-tex">p_x</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>z</mi></msub><annotation encoding="application/x-tex">p_z</annotation></semantics></math>,
respectively, to be treated as nonrandom or fixed by conditioning. While
we allow correlation between the variables, we will assume that the
matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mi>X</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>Z</mi></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow><mi>′</mi><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mi>X</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>Z</mi></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{pmatrix} X &amp; Z \end{pmatrix}' \begin{pmatrix} X &amp; Z \end{pmatrix}</annotation></semantics></math>
has an inverse (I think most of these results would work with
generalized inverses, but if does not exist it makes the dimesionality
of the coefficients a little tricky).</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><mi>α</mi><mi>′</mi><mi>x</mi><mo>+</mo><mi>β</mi><mi>′</mi><mi>z</mi><mo>+</mo><mi>ϵ</mi><mo>,</mo><mspace width="1.0em"></mspace><mi>E</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ϵ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0</mn><mo>,</mo><mtext mathvariant="normal">Var</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>ϵ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mi>σ</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">Y = \alpha'x + \beta'z + \epsilon, \quad E(\epsilon) = 0, \text{Var}(\epsilon) = \sigma^2</annotation></semantics></math></p>
<p>Standard results give us</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mover><mi>α</mi><mo accent="true">̂</mo></mover><mn>1</mn></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>1</mn></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mi>X</mi><mi>′</mi><mi>X</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>X</mi><mi>′</mi><mi>Z</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>Z</mi><mi>′</mi><mi>X</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>Z</mi><mi>′</mi><mi>Z</mi></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mi>X</mi><mi>′</mi><mi>y</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>Z</mi><mi>′</mi><mi>y</mi></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\begin{pmatrix} \hat \alpha_1 \\ \hat \beta_1 \end{pmatrix} = \begin{pmatrix} X'X &amp; X'Z \\ Z'X &amp; Z'Z \end{pmatrix}^{-1} \begin{pmatrix} X'y \\ Z'y \end{pmatrix}
</annotation></semantics></math> and that the variance of the estimators
is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>σ</mi><mn>2</mn></msup><msup><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mi>X</mi><mi>′</mi><mi>X</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>X</mi><mi>′</mi><mi>Z</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>Z</mi><mi>′</mi><mi>X</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>Z</mi><mi>′</mi><mi>Z</mi></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\sigma^2 \begin{pmatrix} X'X &amp; X'Z \\ Z'X &amp; Z'Z \end{pmatrix}^{-1}</annotation></semantics></math>
Results for blocked matrices (e.g., The Matrix Cookbook) give the
variance for just
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>β</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat \beta</annotation></semantics></math>
as
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Var</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mi>σ</mi><mn>2</mn></msup><msup><mrow><mo stretchy="true" form="prefix">[</mo><mi>Z</mi><mi>′</mi><mi>Z</mi><mo>−</mo><mi>Z</mi><mi>′</mi><mi>X</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mi>′</mi><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>X</mi><mi>′</mi><mi>Z</mi><mo stretchy="true" form="postfix">]</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\text{Var}(\hat \beta_1) = \sigma^2 \left[Z'Z - Z' X (X'X)^{-1} X'Z\right]^{-1}</annotation></semantics></math>
Write
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo>=</mo><mi>I</mi><mo>−</mo><mi>X</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mi>′</mi><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>X</mi><mi>′</mi></mrow><annotation encoding="application/x-tex">H = I - X (X'X)^{-1} X'</annotation></semantics></math>,
matrix that creates the residuals of the regression on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
alone. Then,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Var</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mi>σ</mi><mn>2</mn></msup><msup><mrow><mo stretchy="true" form="prefix">[</mo><mi>Z</mi><mi>′</mi><mi>H</mi><mi>Z</mi><mo stretchy="true" form="postfix">]</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\text{Var}(\hat \beta_1) = \sigma^2 \left[Z'H Z\right]^{-1}</annotation></semantics></math></p>
<p>The same
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>1</mn></msub><annotation encoding="application/x-tex">\hat \beta_1</annotation></semantics></math>
arises as the coefficient of a regression of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mi>Y</mi></mrow><annotation encoding="application/x-tex">HY</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mi>Z</mi></mrow><annotation encoding="application/x-tex">HZ</annotation></semantics></math>
(by the so-called Frisch-Waugh-Lovell Theorem). In consequence,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>1</mn></msub><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Z</mi><mi>′</mi><mi>H</mi><mi>Z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Z</mi><mi>′</mi><mi>H</mi><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">\hat \beta_1 = (Z'HZ)^{-1}(Z'Hy) .</annotation></semantics></math></p>
</div>
<div class="section level2">
<h2 id="two-regressions">Two regressions<a class="anchor" aria-label="anchor" href="#two-regressions"></a>
</h2>
<p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>α</mi><mo accent="true">̂</mo></mover><mn>2</mn></msub><annotation encoding="application/x-tex">\hat \alpha_2</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>2</mn></msub><annotation encoding="application/x-tex">\hat \beta_2</annotation></semantics></math>
be the estimators from first regression on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
alone and then regressing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>−</mo><msub><mover><mi>α</mi><mo accent="true">̂</mo></mover><mn>2</mn></msub><mi>′</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">Y - \hat \alpha_2'x</annotation></semantics></math>,
that is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mi>H</mi></mrow><annotation encoding="application/x-tex">YH</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>H</mi><annotation encoding="application/x-tex">H</annotation></semantics></math>
as defined above, on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>.
Standard results give</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>α</mi><mo accent="true">̂</mo></mover><mn>2</mn></msub><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mi>′</mi><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>X</mi><mi>′</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">\hat \alpha_2 = (X'X)^{-1} X' y</annotation></semantics></math>
and
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>2</mn></msub><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Z</mi><mi>′</mi><mi>Z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>Z</mi><mi>′</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>−</mo><mi>X</mi><msub><mover><mi>α</mi><mo accent="true">̂</mo></mover><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Z</mi><mi>′</mi><mi>Z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>Z</mi><mi>′</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>−</mo><mi>X</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mi>′</mi><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>X</mi><mi>′</mi><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Z</mi><mi>′</mi><mi>Z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>Z</mi><mi>′</mi><mi>H</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">\hat \beta_2 = (Z'Z)^{-1} Z' (y - X \hat \alpha_2)  = (Z'Z)^{-1} Z'(y - X (X'X)^{-1} X' y) = (Z'Z)^{-1} Z' H y</annotation></semantics></math></p>
<p>As both
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
are taken to be nonrandom, we may pass between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>1</mn></msub><annotation encoding="application/x-tex">\hat \beta_1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>2</mn></msub><annotation encoding="application/x-tex">\hat \beta_2</annotation></semantics></math>
via nonrandom linear transformations, as follows:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>1</mn></msub><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Z</mi><mi>′</mi><mi>H</mi><mi>Z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Z</mi><mi>′</mi><mi>Z</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>2</mn></msub><mo>;</mo><mspace width="1.0em"></mspace><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>2</mn></msub><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Z</mi><mi>′</mi><mi>Z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Z</mi><mi>′</mi><mi>H</mi><mi>Z</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>1</mn></msub><mi>.</mi></mrow><annotation encoding="application/x-tex">\hat \beta_1 = (Z'HZ)^{-1}(Z'Z) \hat \beta_2;\quad \hat \beta_2 = (Z'Z)^{-1}(Z'HZ) \hat \beta_1 .</annotation></semantics></math>
Accordingly
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Cov</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Z</mi><mi>′</mi><mi>H</mi><mi>Z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Z</mi><mi>′</mi><mi>Z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>Cov</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>β</mi><mo accent="true">̂</mo></mover><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>Z</mi><mi>′</mi><mi>Z</mi><mo stretchy="true" form="postfix">)</mo></mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Z</mi><mi>′</mi><mi>H</mi><mi>Z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex"> \operatorname{Cov}(\hat \beta_1) = (Z'HZ)^{-1}(Z'Z)
\operatorname{Cov}(\hat \beta_{2})(Z'Z) (Z'HZ)^{-1}</annotation></semantics></math>
which may serve as a basis for tests.</p>
<!-- The standard expression of $\hat \beta_2$'s variance is
$$\text{Var}(\hat \beta_2) = \sigma^2 (Z'Z)^{-1} Z' H Z (Z'Z)^{-1}.$$
Considering the SVD of $Z = UDV'$, an alternate variance expression above entails
$$\text{Var}(\hat \beta_2) = \sigma^2 V D^{-2} V' V D U' H U D V' V D^{-2} V' = \sigma^2 V D^{-1} U' H U D^{-1} V' = \sigma^2 \left[Z^{-}\right]' H^{-} Z^{-} $$

where $Z^{-}$ is the generalized inverse of $Z$ and $H$ is its own generalized inverse as it is idempotent.-->
<!-- ## Estimating $\sigma^2$

Define $G = I - Z(Z'Z)^{-1}Z'$

In the the first model, the usual estimator of $\sigma^2$ would be 
\[
\begin{aligned}
\hat \sigma_1^2 &= \frac{1}{n - (p_x + p_z)} (y - X \hat \alpha_1 - Z \hat \beta_1)' (y - X \hat \alpha_1 - Z \hat \beta_1) \\
&= \frac{1}{n - (p_x + p_z)} y' \left[I - \begin{pmatrix} X & Z \end{pmatrix} \begin{pmatrix} X'X & X'Z \\ Z'X & Z'Z \end{pmatrix}^{-1} \begin{pmatrix} X & Z \end{pmatrix}' \right] y\\
&= \frac{1}{n - (p_x + p_z)} y' \left[I - X (X'GX)^{-1} X'G - Z(Z'HZ)^{-1} Z'H \right] y
\end{aligned}
\]
-->
<!-- Proof of last line
\[
\begin{aligned}
a &= \begin{pmatrix} X'X & X'Z \\ Z'X & Z'Z \end{pmatrix}^{-1
} \\
&= \begin{pmatrix} (X'GX)^{-1} & 0 \\ 0 & (Z'HZ)^{-1} \end{pmatrix} \begin{pmatrix} I & - X'Z (Z'Z)^{-1} \\ - Z'X (X'X)^{-1} & I \end{pmatrix}
\end{aligned}
\]

\[
\begin{aligned}
\begin{pmatrix}X & Z \\ 0 & 0 \end{pmatrix}\begin{pmatrix} (X'GX)^{-1} & 0 \\ 0 & (Z'HZ)^{-1} \end{pmatrix}
 &= \begin{pmatrix}
 X (X'GX)^{-1} & Z (Z'HZ) ^{-1} \\
 0 & 0 \end{pmatrix}
 \end{aligned}
\]

\[
\begin{pmatrix} I & - X'Z (Z'Z)^{-1} \\ - Z'X (X'X)^{-1} & I \end{pmatrix} \begin{pmatrix} X' & 0 \\ Z' & 0 \end{pmatrix} = 
\begin{pmatrix}
X'G & 0 \\
Z'H & 0
\end{pmatrix}
\]

\[
\begin{pmatrix} X & Z \end{pmatrix} \begin{pmatrix} X'X & X'Z \\ Z'X & Z'Z \end{pmatrix}^{-1} \begin{pmatrix} X & Z \end{pmatrix}' =
\begin{pmatrix} X (X'GX)^{-1} X' G + Z(Z'HZ)^{-1} Z'H & 0 \\
0 & 0\end{pmatrix} = X (X'GX)^{-1} X'G + Z(Z'HZ)^{-1} Z'H
\]
-->
<!-- In the second case, the usual naive estimate of the variance that does not take into account the fact that $\hat \alpha_2$ is random would be

\[ 
\begin{aligned}
\hat \sigma_2^2  
  &= \frac{1}{n - p_z} (y - X \hat \alpha_2 - Z \hat \beta_2)' (y - X \hat \alpha_2 - Z \hat \beta_2) \\
  &= \frac{1}{n - p_z} y' (H - Z (Z'Z)^{-1} Z' H )' (H - Z (Z'Z)^{-1} Z' H) y \\
  &= \frac{1}{n - p_z} y' [(I - Z (Z'Z)^{-1} Z') H ]' (I - Z (Z'Z)^{-1} Z') H y \\
  &= \frac{1}{n - p_z} y' H G H y 
\end{aligned}
\]
-->
</div>
<div class="section level2">
<h2 id="todo">TODO<a class="anchor" aria-label="anchor" href="#todo"></a>
</h2>
<ul>
<li>Implement as tests.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Josh Errickson, Josh Wasserman, Ben Hansen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
