<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Linear Model for Intention To Treat — lmitt • propertee</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Linear Model for Intention To Treat — lmitt"><meta name="description" content="Generates a linear model object to estimate a treatment effect,
with proper estimation of variances accounting for the study
specification."><meta property="og:description" content="Generates a linear model object to estimate a treatment effect,
with proper estimation of variances accounting for the study
specification."><meta property="og:image" content="www.github.com/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">propertee</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.6.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><h6 class="dropdown-header" data-toc-skip>Basic</h6></li>
    <li><a class="dropdown-item" href="../articles/intro-to-propertee.html">Introduction to propertee</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/non-binary-treatment.html">Non-binary Treatment Specification</a></li>
    <li><a class="dropdown-item" href="../articles/RDD.html">Regression Discontinuity Designs</a></li>
    <li><a class="dropdown-item" href="../articles/geex_vs_propertee.html">propertee vs. geex</a></li>
    <li><a class="dropdown-item" href="../articles/mi_vignette/index.html">Real-data demonstration with a finely stratified cluster RCT and a broader administrative database</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/benbhansen-stats/propertee/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Linear Model for Intention To Treat</h1>
      <small class="dont-index">Source: <a href="https://github.com/benbhansen-stats/propertee/blob/main/R/lmitt.R" class="external-link"><code>R/lmitt.R</code></a></small>
      <div class="d-none name"><code>lmitt.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Generates a linear model object to estimate a treatment effect,
with proper estimation of variances accounting for the study
specification.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">lmitt</span><span class="op">(</span><span class="va">obj</span>, <span class="va">specification</span>, <span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'formula'</span></span>
<span><span class="fu">lmitt</span><span class="op">(</span></span>
<span>  <span class="va">obj</span>,</span>
<span>  <span class="va">specification</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  absorb <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  offset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'lm'</span></span>
<span><span class="fu">lmitt</span><span class="op">(</span><span class="va">obj</span>, specification <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-obj">obj<a class="anchor" aria-label="anchor" href="#arg-obj"></a></dt>
<dd><p>A <code>formula</code> or a <code>lm</code> object. See Details.</p></dd>


<dt id="arg-specification">specification<a class="anchor" aria-label="anchor" href="#arg-specification"></a></dt>
<dd><p>The <code>StudySpecification</code> to be used.
Alternatively, a formula creating a specification (of the type of that
would be passed as the first argument to <code><a href="StudySpecification_objects.html">rd_spec()</a></code>, <code><a href="StudySpecification_objects.html">rct_spec()</a></code>, or
<code><a href="StudySpecification_objects.html">obs_spec()</a></code>). If the formula includes a <code><a href="StudySpecificationSpecials.html">forcing()</a></code> element, an RD
specification is created. Otherwise an observational specification is
created. An RCT specification must be created manually using <code><a href="StudySpecification_objects.html">rct_spec()</a></code>.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A <code>data.frame</code> such as would be passed into <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code>. One such argument is
<code>dichotomy</code>, which can be used to dichotomize a non-binary treatment
variable in <code>specification</code>. See the Details section of the
<code><a href="WeightCreators.html">ett()</a></code> or <code><a href="WeightCreators.html">att()</a></code> help pages for information on specifying this
formula.</p></dd>


<dt id="arg-absorb">absorb<a class="anchor" aria-label="anchor" href="#arg-absorb"></a></dt>
<dd><p>If <code>TRUE</code>, fixed effects are included for blocks
identified in the <code>StudySpecification</code>. Excluded in <code>FALSE</code>.
Default is <code>FALSE</code>. The estimates of these fixed effects are
suppressed from the returned object.</p></dd>


<dt id="arg-offset">offset<a class="anchor" aria-label="anchor" href="#arg-offset"></a></dt>
<dd><p>Offset of the kind which would be passed into <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code>. Ideally,
this should be the output of <code><a href="cov_adj.html">cov_adj()</a></code>.</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>Which weights should be generated? Options are <code>"ate"</code>
or <code>"ett"</code>. Alternatively, the output of a manually run <code><a href="WeightCreators.html">ate()</a></code>
or <code><a href="WeightCreators.html">ett()</a></code> can be used.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>teeMod</code> object (see Details)</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The first argument to <code>lmitt()</code> should be a formula specifying the
outcome on the left hand side. The right hand side of the formula can be
any of the following:</p>
<ul><li><p><code>1</code>: Estimates a main treatment effect.</p></li>
<li><p>a subgroup variable: Estimates a treatment effect within each level
of your subgrouping variable.</p></li>
<li><p>a continuous moderator: Estimates a main treatment effect as well as
a treatment by moderator interaction. The moderator is not
automatically centered.</p></li>
</ul><p>Alternatively, <code>obj</code> can be a pre-created <code>lm</code> object. No
modification is made to the formula of the object. See the help for
<code><a href="as_lmitt.html">as.lmitt()</a></code> for details of this conversion.</p>
<p>The <code>lmitt()</code> function's <code>subset=</code> argument governs
the subsetting of <code>data</code> prior to model fitting, just as with <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code>.
Functions such as <code><a href="StudySpecification_objects.html">rct_spec()</a></code> that create <code>StudySpecification</code>s
also take an optional <code>subset=</code> argument, but its role differs
from that of the <code>subset=</code> argument of <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> or <code>lmitt()</code>. The <code>subset=</code>
argument when creating a <code>StudySpecification</code> restricts the data used
to generate the <code>StudySpecification</code>, but has no direct impact on the
future <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> or <code>lmitt()</code> calls using that
<code>StudySpecification</code>. (It can have an indirect impact by excluding
particular units from receiving a treatment assignment or weight. When
treatment assignments or weights are reconstructed from the <code>StudySpecification</code>,
these units will receive NAs, and will be excluded from the <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code>
or <code>lmitt()</code> fit under typical <code>na.action</code> settings.)</p>
<p>To avoid variable name collision, the treatment variable defined in the
<code>specification</code> will have a "<code>.</code>" appended to it. For example, if
you request a main treatment effect (with a formula of <code>~ 1</code>) with a
treatment variable named "txt", you can obtain its estimate from the
returned <code>teeMod</code> object via <code>$coefficients["txt."]</code>.</p>
<p><code>lmitt()</code> will produce a message if the <code>StudySpecification</code> passed in
has block information that is not being used to inform weights or a block
fixed effect adjustment. This is not an error, but it often represents an
oversight on the part of the analyst. To disable this
message, run <code>options("propertee_message_on_unused_blocks" = FALSE)</code>.</p>
<p><code>lmitt()</code> returns objects of class ‘<code>teeMod</code>’, for
Treatment Effect Estimate Model, extending the lm class to add a
summary of the response distribution under control (the
coefficients of a controls-only regression of the response on an
intercept and any moderator variable).  <code>teeMod</code> objects also
record the underlying <code>StudySpecification</code> and information
about any externally fitted models <code>mod</code> that may have been
used for covariance adjustment by passing
<code>offset=cov_adj(mod)</code>. In the latter case, responses are
offsetted by predictions from <code>mod</code> prior to treatment effect
estimation, but estimates of the response variable distribution
under control are calculated without reference to <code>mod</code>.</p>
<p>The response distribution under control is also characterized when
treatment effects are estimated with block fixed effects, i.e. for
<code>lmitt()</code> with a <code>formula</code> first argument with option
<code>absorb=TRUE</code>.  Here as otherwise, the supplementary
coefficients describe a regression of the response on an intercept
and moderator variables, to which only control observations
contribute; but in this case the weights are modified for this
supplementary regression. The treatment effect estimates adjusted
for block fixed effects can be seen to coincide with estimates
calculated without block effect but with weights multiplied by an
additional factor specific to the combination of block and
treatment condition. For block \(s\) containing units with weights
\(w_i\) and binary treatment assignments \(z_i\), define
\(\hat{\pi}_s\) by \(\hat{\pi}_s\sum_sw_i=\sum_sz_iw_i\). If
\(\hat{\pi}_s\) is 0 or 1, the block doesn't contribute to
effect estimation and the additional weighting factor is 0; if
\(0 &lt; \hat{\pi}_s &lt; 1\), the additional weighting factor is
\(1 - \hat{\pi}_s\) for treatment group members and
\(\hat{\pi}_s\) for controls. When estimating a main effect only
or a main effect with continuous moderator, supplementary
coefficients under option <code>absorb=TRUE</code> reflect regressions
with additional weighting factor equal to 0 or \(\hat{\pi}_s\),
respectively, for treatment or control group members of block
\(s\). With a categorical moderator and <code>absorb=TRUE</code>,
this additional weighting factor determining supplementary coefficients
is calculated separately for each level \(\ell\) of the moderator
variable, with the sums defining \(\hat{\pi}_{s\ell}\) restricted
not only to block \(s\) but also to observations with moderator
equal to \(\ell\).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="StudySpecification_objects.html">rct_spec</a></span><span class="op">(</span><span class="va">z</span> <span class="op">~</span> <span class="fu"><a href="StudySpecificationSpecials.html">unit_of_assignment</a></span><span class="op">(</span><span class="va">uoa1</span>, <span class="va">uoa2</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">simdata</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu">lmitt</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">simdata</span>, specification <span class="op">=</span> <span class="va">spec</span>, weights <span class="op">=</span> <span class="st">"ate"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu">lmitt</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">o</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">simdata</span>, specification <span class="op">=</span> <span class="va">spec</span>, weights <span class="op">=</span> <span class="st">"ate"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mod3</span> <span class="op">&lt;-</span> <span class="fu">lmitt</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">simdata</span>,</span></span>
<span class="r-in"><span>              specification <span class="op">=</span> <span class="va">z</span> <span class="op">~</span> <span class="fu"><a href="StudySpecificationSpecials.html">uoa</a></span><span class="op">(</span><span class="va">uoa1</span>, <span class="va">uoa2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="StudySpecificationSpecials.html">forcing</a></span><span class="op">(</span><span class="va">force</span><span class="op">)</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Josh Errickson, Josh Wasserman, Ben Hansen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

