---
title: "Regression Discontinuity Designs"
author: "Adam Sales"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Regression Discontinuity Designs}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(tidyverse)
```

```{r}
library(flexida)
```


## Data and Design

The data were compiled by Ludwig & Miller (2007; henceforth LM), largely from the National Archives and Records Administration and Vital Statistics, and were cleaned and provided by the `RDHonest` package for R.

At the onset of the Head Start preschool program in 1965, the Office of Economic Opportunity provided technical support in applying for funding to the 300 US counties with the highest 1960 poverty rates. LM show that this assistance paid off, in that couties with poverty rates just above the cutoff received substantially more Head Start funding than those with poverty rates just below the cutoff. LM then sought to estimate the impact of this additional funding on two county-level outcomes that may plausibly affected by Head Start: child mortality due to health risks addressed by the Head Start program, and high school completion rates. 

```{r, eval=FALSE}
devtools::install_github('kolesarm/RDHonest')
```

```{r, eval=FALSE, results = 'hide', message = FALSE, error = FALSE, warning = FALSE}
library(RDHonest)
data(headst)
```

```{r, include=FALSE}
download.file("https://github.com/kolesarm/RDHonest/raw/master/data/headst.rda","../data/headst.rda")
load("../data/headst.rda")
```

The variable `povrate60` encodes county-level poverty rates, as of 1960, relative to the 300th poorest county (Campbell County, TN).
`mortHS` records 1973-1983 county-level child mortality rates for causes targeted by Head Start, and `highSchool` records 1990 high school graduation rates for adults ages 18-24, LM's two main outcomes.

```{r rddPlots,fig.width=7}
headst%>%
    filter(abs(povrate60)<36)%>% ## LM's biggest bandwidth
    filter(mortHS<15)%>% ## remove outliers
    mutate(Z=ifelse(povrate60>=0,"Assistance","No Assistance"))%>% ## the "treatment"--assistance in applying for funding
    pivot_longer(cols=c(mortHS,highSchool),names_to="Outcome")%>%
    ggplot(aes(povrate60,value,color=Z))+
    stat_summary_bin(geom="point",fun="mean",bins=50)+
    geom_point(alpha=0.05)+
    facet_wrap(~Outcome,scales="free_y")+
    geom_smooth()+
    geom_vline(xintercept=-0.005,linetype="dotted")+
    theme(legend.title=element_blank(),legend.pos='top')
```
## Background

### Regression Discontinuity Designs

### Analyzing RDDs with ANCOVA

### The `flexida` Approach to RDDs

### RDD Specification Tests

