<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Prior to obtaining predicted values, cov_adj() tries to identify the
treatment variable (as specified in the design) and replace it with
the reference level. If the treatment is binary, this is FALSE. If
treatment is numeric, it is the smallest non-negative value (note that this
means for 0/1 binary, it uses a 0). Factor treatments are not currently
supported, but if we add them, it will use the first level() of the
factor, you may change this by using relevel() to adjust."><title>Covariance Adjustment for Treatment Estimation — cov_adj • propertee</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Covariance Adjustment for Treatment Estimation — cov_adj"><meta property="og:description" content="Prior to obtaining predicted values, cov_adj() tries to identify the
treatment variable (as specified in the design) and replace it with
the reference level. If the treatment is binary, this is FALSE. If
treatment is numeric, it is the smallest non-negative value (note that this
means for 0/1 binary, it uses a 0). Factor treatments are not currently
supported, but if we add them, it will use the first level() of the
factor, you may change this by using relevel() to adjust."><meta property="og:image" content="www.github.com/logo.png"><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">propertee</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.3.8.9002</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/design_based_SEs.html">Design based sandwich SEs for differences of Hajek estimators</a>
    <a class="dropdown-item" href="../articles/not-for-cran/geex_vs_propertee.html">propertee vs. geex</a>
    <a class="dropdown-item" href="../articles/intro-to-propertee.html">Introduction to propertee</a>
    <a class="dropdown-item" href="../articles/LinearModelVarianceEstimation.html">Variance Estimation Testing Using A Simple Linear Specification</a>
    <a class="dropdown-item" href="../articles/non-binary-treatment.html">Non-binary Treatment Specification</a>
    <a class="dropdown-item" href="../articles/RDD.html">Regression Discontinuity Designs</a>
    <a class="dropdown-item" href="../articles/sandwich_infrastructure.html">Data structures to support standard error calculations for direct adjustment assisted by a prior covariance model</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/benbhansen-stats/propertee/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Covariance Adjustment for Treatment Estimation</h1>
      <small class="dont-index">Source: <a href="https://github.com/benbhansen-stats/propertee/blob/HEAD/R/cov_adj.R" class="external-link"><code>R/cov_adj.R</code></a></small>
      <div class="d-none name"><code>cov_adj.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Prior to obtaining predicted values, <code>cov_adj()</code> tries to identify the
treatment variable (as specified in the <code>design</code>) and replace it with
the reference level. If the treatment is binary, this is <code>FALSE</code>. If
treatment is numeric, it is the smallest non-negative value (note that this
means for 0/1 binary, it uses a 0). Factor treatments are not currently
supported, but if we add them, it will use the first <code>level()</code> of the
factor, you may change this by using <code><a href="https://rdrr.io/r/stats/relevel.html" class="external-link">relevel()</a></code> to adjust.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">cov_adj</span><span class="op">(</span><span class="va">model</span>, newdata <span class="op">=</span> <span class="cn">NULL</span>, design <span class="op">=</span> <span class="cn">NULL</span>, by <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>model</dt>
<dd><p>Any model that inherits from a <code>glm</code>, <code>lm</code>, or
<code><a href="https://rdrr.io/pkg/robustbase/man/lmrob.html" class="external-link">robustbase::lmrob</a></code> object</p></dd>


<dt>newdata</dt>
<dd><p>Optional; a data.frame of new data</p></dd>


<dt>design</dt>
<dd><p>Optional <code>Design</code>. If not provided, the function will
search through the call stack to find one.</p></dd>


<dt>by</dt>
<dd><p>optional; vector or list connecting names of unit of
assignment/unitid/cluster variables in <code>design</code> to unit of
assignment/unitid/cluster variables in the covariance adjustment data. If
a named vector, names should represent variables in the <code>Design</code>
object and values should represent variables in the data. Only needed if:</p><ol><li><p>columns not related to the design should be used for merging the
covariance adjustment and quasiexperimental samples, or 2) the column
names differ between the datasets used to fit both models.</p></li>
</ol></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p><code>SandwichLayer</code> or <code>PreSandwichLayer</code> object; the former
if <code>design</code> is provided or a <code>design</code> can be found in the call stack,
otherwise the latter. The values represent the covariance adjustments for
the observations in <code>newdata</code>, if <code>newdata</code> is provided or found as an
argument to <code>lmitt.formula</code>, or the fitted values from <code>model</code>. The
length of the output of <code>cov_adj()</code> varies depending on this logic.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">STARdata</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">STARdata</span><span class="op">$</span><span class="va">treatment</span> <span class="op">&lt;-</span> <span class="va">STARdata</span><span class="op">$</span><span class="va">stark</span> <span class="op">==</span> <span class="st">"small"</span></span></span>
<span class="r-in"><span><span class="va">STARdata</span><span class="op">$</span><span class="va">treatment</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">STARdata</span><span class="op">$</span><span class="va">treatment</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="va">STARdata</span><span class="op">$</span><span class="va">studentid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">STARdata</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">covariance_y0_read</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">readk</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">ethnicity</span> <span class="op">+</span> <span class="va">lunchk</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                                 <span class="va">ladderk</span> <span class="op">+</span> <span class="va">experiencek</span> <span class="op">+</span> <span class="va">tethnicityk</span>,</span></span>
<span class="r-in"><span>                         data <span class="op">=</span> <span class="va">STARdata</span>, subset <span class="op">=</span> <span class="op">!</span><span class="va">treatment</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">STARdata_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="Design_objects.html">rct_design</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">~</span> <span class="fu"><a href="DesignSpecials.html">cluster</a></span><span class="op">(</span><span class="va">studentid</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">STARdata</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">STARdata_ate</span>    <span class="op">&lt;-</span> <span class="fu"><a href="WeightCreators.html">ate</a></span><span class="op">(</span><span class="va">STARdata_design</span>, data <span class="op">=</span> <span class="va">STARdata</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">STARdata_ett</span>    <span class="op">&lt;-</span> <span class="fu"><a href="WeightCreators.html">ett</a></span><span class="op">(</span><span class="va">STARdata_design</span>, data <span class="op">=</span> <span class="va">STARdata</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ett_read</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">readk</span> <span class="op">~</span> <span class="va">treatment</span>,</span></span>
<span class="r-in"><span>               offset <span class="op">=</span> <span class="fu">cov_adj</span><span class="op">(</span><span class="va">covariance_y0_read</span>, newdata <span class="op">=</span> <span class="va">STARdata</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               data <span class="op">=</span> <span class="va">STARdata</span>,</span></span>
<span class="r-in"><span>               weights <span class="op">=</span> <span class="va">STARdata_ett</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Some covariance adjustments are NA; be careful of dropping these observations when fitting the ITT effect model</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">ett_read</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   (Intercept) treatmentTRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -8.224997e-13  5.554179e+00 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ate_read</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">readk</span> <span class="op">~</span> <span class="va">treatment</span>,</span></span>
<span class="r-in"><span>               offset <span class="op">=</span> <span class="fu">cov_adj</span><span class="op">(</span><span class="va">covariance_y0_read</span>, newdata <span class="op">=</span> <span class="va">STARdata</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               data <span class="op">=</span> <span class="va">STARdata</span>,</span></span>
<span class="r-in"><span>               weights <span class="op">=</span> <span class="va">STARdata_ate</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Some covariance adjustments are NA; be careful of dropping these observations when fitting the ITT effect model</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">ate_read</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   (Intercept) treatmentTRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -5.334478e-13  5.554179e+00 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ate_read_eth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">readk</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">*</span> <span class="va">ethnicity</span>,</span></span>
<span class="r-in"><span>                   offset <span class="op">=</span> <span class="fu">cov_adj</span><span class="op">(</span><span class="va">covariance_y0_read</span>, newdata <span class="op">=</span> <span class="va">STARdata</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   data <span class="op">=</span> <span class="va">STARdata</span>,</span></span>
<span class="r-in"><span>                   weights <span class="op">=</span> <span class="va">STARdata_ate</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Some covariance adjustments are NA; be careful of dropping these observations when fitting the ITT effect model</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">ate_read_eth</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     (Intercept)                   treatmentTRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   -4.599280e-13                    5.901494e+00 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   ethnicityafam                  ethnicityasian </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   -1.267935e-13                    5.281315e-13 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               ethnicityhispanic               ethnicityamindian </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    6.750873e-12                    1.579858e-12 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  ethnicityother     treatmentTRUE:ethnicityafam </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    3.151440e-12                   -1.289929e+00 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    treatmentTRUE:ethnicityasian treatmentTRUE:ethnicityhispanic </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   -2.494972e+01                    3.214437e+01 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treatmentTRUE:ethnicityamindian    treatmentTRUE:ethnicityother </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    1.391799e+01                    3.202748e+00 </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Josh Errickson, Josh Wasserman, Ben Hansen.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.8.</p>
</div>

    </footer></div>

  

  

  </body></html>

