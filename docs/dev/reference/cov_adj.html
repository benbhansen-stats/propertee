<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="cov_adj() takes a fitted covariance model and returns the information
necessary for adjusting direct adjustment model estimates and associated
standard errors for covariates. Standard errors will reflect adjustments made
to the outcomes as well as contributions to sampling variability arising from
the estimates of the covariance adjustment model coefficients."><title>Covariance adjustment of DirectAdjusted model estimates — cov_adj • propertee</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Covariance adjustment of DirectAdjusted model estimates — cov_adj"><meta property="og:description" content="cov_adj() takes a fitted covariance model and returns the information
necessary for adjusting direct adjustment model estimates and associated
standard errors for covariates. Standard errors will reflect adjustments made
to the outcomes as well as contributions to sampling variability arising from
the estimates of the covariance adjustment model coefficients."><meta property="og:image" content="www.github.com/logo.png"><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">propertee</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.3.9.9001</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Basic</h6>
    <a class="dropdown-item" href="../articles/intro-to-propertee.html">Introduction to propertee</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Advanced</h6>
    <a class="dropdown-item" href="../articles/non-binary-treatment.html">Non-binary Treatment Specification</a>
    <a class="dropdown-item" href="../articles/RDD.html">Regression Discontinuity Designs</a>
    <a class="dropdown-item" href="../articles/not-for-cran/geex_vs_propertee.html">propertee vs. geex</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Theory</h6>
    <a class="dropdown-item" href="../articles/sandwich_infrastructure.html">Data structures to support standard error calculations for direct adjustment assisted by a prior covariance model</a>
    <a class="dropdown-item" href="../articles/LinearModelVarianceEstimation.html">Variance Estimation Testing Using A Simple Linear Specification</a>
    <a class="dropdown-item" href="../articles/design_based_SEs.html">Design based sandwich SEs for differences of Hajek estimators</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/benbhansen-stats/propertee/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Covariance adjustment of <code>DirectAdjusted</code> model estimates</h1>
      <small class="dont-index">Source: <a href="https://github.com/benbhansen-stats/propertee/blob/HEAD/R/cov_adj.R" class="external-link"><code>R/cov_adj.R</code></a></small>
      <div class="d-none name"><code>cov_adj.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>cov_adj()</code> takes a fitted covariance model and returns the information
necessary for adjusting direct adjustment model estimates and associated
standard errors for covariates. Standard errors will reflect adjustments made
to the outcomes as well as contributions to sampling variability arising from
the estimates of the covariance adjustment model coefficients.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">cov_adj</span><span class="op">(</span><span class="va">model</span>, newdata <span class="op">=</span> <span class="cn">NULL</span>, design <span class="op">=</span> <span class="cn">NULL</span>, by <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>model</dt>
<dd><p>any model that inherits from a <code>glm</code>, <code>lm</code>, or
<code><a href="https://rdrr.io/pkg/robustbase/man/lmrob.html" class="external-link">robustbase::lmrob</a></code> object</p></dd>


<dt>newdata</dt>
<dd><p>a dataframe of new data. Default is NULL, in which case
a dataframe is sought from higher up the call stack.</p></dd>


<dt>design</dt>
<dd><p>a <code>Design</code> object. Default is NULL, in which case a
<code>Design</code> object is sought from higher up the call stack.</p></dd>


<dt>by</dt>
<dd><p>optional; a string or named vector of unique identifier columns in
the data used to create <code>design</code> and the data used to fit the covariance
adjustment model. Default is NULL, in which case unit of assignment columns
are used for identification (even if they do not uniquely identify units of
observation). If a named vector is provided, names should represent variables
in the data used to create <code>design</code>, while values should represent
variables in the covariance adjustment data.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A <code>SandwichLayer</code> if <code>design</code> is not NULL or a <code>Design</code></p>


<p>object is found in the call stack, otherwise a <code>PreSandwichLayer</code> object</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Prior to generating adjustments, <code>cov_adj()</code> identifies the
treatment variable specified in the <code>Design</code> object passed to
<code>design</code> and replaces all values with a reference level. If the treatment has
logical type, this reference level is <code>FALSE</code>, and if it has numeric type,
this is the smallest non-negative value (which means 0 for 0/1 binary).
Factor treatments are not currently supported for <code>Design</code> objects.<br><br>
The values of the output vector represent adjustments for the outcomes in
<code>newdata</code> if <code>newdata</code> is provided; adjustments for the outcomes
in the data used to fit a <code>DirectAdjusted</code> model if <code>cov_adj()</code>
is called within the <code>offset</code> argument of the model fit; or they are
the fitted values from <code>model</code> if no relevant dataframe can be extracted
from the call stack. The length of the output of <code>cov_adj()</code> will match
the number of rows of the dataframe used.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">STARdata</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">STARdata</span><span class="op">$</span><span class="va">treatment</span> <span class="op">&lt;-</span> <span class="va">STARdata</span><span class="op">$</span><span class="va">stark</span> <span class="op">==</span> <span class="st">"small"</span></span></span>
<span class="r-in"><span><span class="va">STARdata</span><span class="op">$</span><span class="va">treatment</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">STARdata</span><span class="op">$</span><span class="va">treatment</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="va">STARdata</span><span class="op">$</span><span class="va">studentid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">STARdata</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">covariance_y0_read</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">readk</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">ethnicity</span> <span class="op">+</span> <span class="va">lunchk</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                                 <span class="va">ladderk</span> <span class="op">+</span> <span class="va">experiencek</span> <span class="op">+</span> <span class="va">tethnicityk</span>,</span></span>
<span class="r-in"><span>                         data <span class="op">=</span> <span class="va">STARdata</span>, subset <span class="op">=</span> <span class="op">!</span><span class="va">treatment</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">STARdata_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="Design_objects.html">rct_design</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">~</span> <span class="fu"><a href="DesignSpecials.html">cluster</a></span><span class="op">(</span><span class="va">studentid</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">STARdata</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">STARdata_ate</span>    <span class="op">&lt;-</span> <span class="fu"><a href="WeightCreators.html">ate</a></span><span class="op">(</span><span class="va">STARdata_design</span>, data <span class="op">=</span> <span class="va">STARdata</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">STARdata_ett</span>    <span class="op">&lt;-</span> <span class="fu"><a href="WeightCreators.html">ett</a></span><span class="op">(</span><span class="va">STARdata_design</span>, data <span class="op">=</span> <span class="va">STARdata</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ett_read</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">readk</span> <span class="op">~</span> <span class="va">treatment</span>,</span></span>
<span class="r-in"><span>               offset <span class="op">=</span> <span class="fu">cov_adj</span><span class="op">(</span><span class="va">covariance_y0_read</span>, newdata <span class="op">=</span> <span class="va">STARdata</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               data <span class="op">=</span> <span class="va">STARdata</span>,</span></span>
<span class="r-in"><span>               weights <span class="op">=</span> <span class="va">STARdata_ett</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Some covariance adjustments are NA; be careful of dropping these observations when fitting the ITT effect model</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">ett_read</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   (Intercept) treatmentTRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -8.224997e-13  5.554179e+00 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ate_read</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">readk</span> <span class="op">~</span> <span class="va">treatment</span>,</span></span>
<span class="r-in"><span>               offset <span class="op">=</span> <span class="fu">cov_adj</span><span class="op">(</span><span class="va">covariance_y0_read</span>, newdata <span class="op">=</span> <span class="va">STARdata</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               data <span class="op">=</span> <span class="va">STARdata</span>,</span></span>
<span class="r-in"><span>               weights <span class="op">=</span> <span class="va">STARdata_ate</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Some covariance adjustments are NA; be careful of dropping these observations when fitting the ITT effect model</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">ate_read</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   (Intercept) treatmentTRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -5.334478e-13  5.554179e+00 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ate_read_eth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">readk</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">*</span> <span class="va">ethnicity</span>,</span></span>
<span class="r-in"><span>                   offset <span class="op">=</span> <span class="fu">cov_adj</span><span class="op">(</span><span class="va">covariance_y0_read</span>, newdata <span class="op">=</span> <span class="va">STARdata</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   data <span class="op">=</span> <span class="va">STARdata</span>,</span></span>
<span class="r-in"><span>                   weights <span class="op">=</span> <span class="va">STARdata_ate</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Some covariance adjustments are NA; be careful of dropping these observations when fitting the ITT effect model</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">ate_read_eth</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     (Intercept)                   treatmentTRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   -4.599280e-13                    5.901494e+00 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   ethnicityafam                  ethnicityasian </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   -1.267935e-13                    5.281315e-13 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               ethnicityhispanic               ethnicityamindian </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    6.750873e-12                    1.579858e-12 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  ethnicityother     treatmentTRUE:ethnicityafam </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    3.151440e-12                   -1.289929e+00 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    treatmentTRUE:ethnicityasian treatmentTRUE:ethnicityhispanic </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   -2.494972e+01                    3.214437e+01 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treatmentTRUE:ethnicityamindian    treatmentTRUE:ethnicityother </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    1.391799e+01                    3.202748e+00 </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Josh Errickson, Josh Wasserman, Ben Hansen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

