<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="flexida">
<title>Variance Estimation Testing Using A Simple Linear Specification â€¢ flexida</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Variance Estimation Testing Using A Simple Linear Specification">
<meta property="og:description" content="flexida">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">flexida</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/CovarianceAdjustment.html">Covariance Adjustment for Randomized Trials</a>
    <a class="dropdown-item" href="../articles/LinearModelVarianceEstimation.html">Variance Estimation Testing Using A Simple Linear Specification</a>
    <a class="dropdown-item" href="../articles/RDD.html">Regression Discontinuity Designs</a>
    <a class="dropdown-item" href="../articles/design_based_SEs.html">Design based sandwich SEs for differences of Hajek estimators</a>
    <a class="dropdown-item" href="../articles/not-for-cran/covadj_with_clustering.html">Covariance-adjusted standard errors in a clustered longitudinal setting</a>
    <a class="dropdown-item" href="../articles/not-for-cran/non-binary-weights.html">Non-Binary Treatment</a>
    <a class="dropdown-item" href="../articles/not-for-cran/polynomialSimulation.html">Polynomial Simulation like in LRD paper</a>
    <a class="dropdown-item" href="../articles/sandwich_infrastructure.html">Data structures to support standard error calculations for direct adjustment assisted by a prior covariance model</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/benbhansen-stats/flexida/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Variance Estimation Testing Using A Simple Linear Specification</h1>
                        <h4 data-toc-skip class="author">Mark Fredrickson</h4>
            
            <h4 data-toc-skip class="date">2022-05-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/benbhansen-stats/flexida/blob/HEAD/vignettes/LinearModelVarianceEstimation.Rmd" class="external-link"><code>vignettes/LinearModelVarianceEstimation.Rmd</code></a></small>
      <div class="d-none name"><code>LinearModelVarianceEstimation.Rmd</code></div>
    </div>

    
    
<p>The goal of this document is to consider a simple model that can be arranged as two separate regressions and relate the variance of the second stage coefficients to those that are fit in the entire model. With this information, we should be able to create tests of our variance estimation routines.</p>
<div class="section level2">
<h2 id="combined-model">Combined model<a class="anchor" aria-label="anchor" href="#combined-model"></a>
</h2>
<p>Consider two sets of background variables and treatment assignments, <span class="math inline">\(x\)</span> and <span class="math inline">\(z\)</span> with dimension <span class="math inline">\(p_x\)</span> and <span class="math inline">\(p_z\)</span>, respectively. While we allow correlation between the variables, we will assume that the matrix <span class="math inline">\(\begin{pmatrix} X &amp; Z \end{pmatrix}' \begin{pmatrix} X &amp; Z \end{pmatrix}\)</span> has an inverse (I think most of these results would work with generalized inverses, but if does not exist it makes the dimesionality of the coefficients a little tricky).</p>
<p><span class="math display">\[Y = \alpha'x + \beta'z + \epsilon, \quad E(\epsilon) = 0, \text{Var}(\epsilon) = \sigma^2\]</span></p>
<p>Standard results give us</p>
<p><span class="math display">\[
\begin{pmatrix} \hat \alpha_1 \\ \hat \beta_1 \end{pmatrix} = \begin{pmatrix} X'X &amp; X'Z \\ Z'X &amp; Z'Z \end{pmatrix}^{-1} \begin{pmatrix} X'y \\ Z'y \end{pmatrix}
\]</span> and that the variance of the estimators is <span class="math display">\[\sigma^2 \begin{pmatrix} X'X &amp; X'Z \\ Z'X &amp; Z'Z \end{pmatrix}^{-1}\]</span> Results for blocked matrices (e.g., The Matrix Cookbook) give the variance for just <span class="math inline">\(\hat \beta\)</span> as <span class="math display">\[\text{Var}(\hat \beta_1) = \sigma^2 \left[Z'Z - Z' X (X'X)^{-1} X'Z\right]^{-1}\]</span> Write <span class="math inline">\(H = I - X (X'X)^{-1} X'\)</span>, matrix that creates the residuals of the regression on <span class="math inline">\(x\)</span> alone. Then, <span class="math display">\[\text{Var}(\hat \beta_1) = \sigma^2 \left[Z'H Z\right]^{-1}\]</span></p>
</div>
<div class="section level2">
<h2 id="two-regressions">Two regressions<a class="anchor" aria-label="anchor" href="#two-regressions"></a>
</h2>
<p>Let <span class="math inline">\(\hat \alpha_2\)</span> and <span class="math inline">\(\hat \beta_2\)</span> be the estimators from first regression on <span class="math inline">\(Y\)</span> on <span class="math inline">\(x\)</span> alone and then regressing <span class="math inline">\(Y - \hat \alpha_2'x\)</span> on <span class="math inline">\(Z\)</span>. Again by standard results we have</p>
<p><span class="math display">\[\hat \alpha_2 = (X'X)^{-1} X' y\]</span> And <span class="math display">\[\hat \beta_2 = (Z'Z)^{-1} Z' (y - X \hat \alpha_2)  = (Z'Z)^{-1} Z'(y - X (X'X)^{-1} X' y) = (Z'Z)^{-1} Z' H y\]</span> The variance of <span class="math inline">\(\hat \beta_2\)</span> would be <span class="math display">\[\text{Var}(\hat \beta_2) = \sigma^2 (Z'Z)^{-1} Z' H Z (Z'Z)^{-1}\]</span> Consider the SVD of <span class="math inline">\(Z = UDV'\)</span>. Then we have <span class="math display">\[\text{Var}(\hat \beta_2) = \sigma^2 V D^{-2} V' V D U' H U D V' V D^{-2} V' = \sigma^2 V D^{-1} U' H U D^{-1} V' = \sigma^2 \left[Z^{-}\right]' H^{-} Z^{-} \]</span></p>
<p>Where <span class="math inline">\(Z^{-}\)</span> is the generalized inverse of <span class="math inline">\(Z\)</span> and <span class="math inline">\(H\)</span> is its own generalized inverse as it is idempotent.</p>
</div>
<div class="section level2">
<h2 id="estimating-sigma2">Estimating <span class="math inline">\(\sigma^2\)</span><a class="anchor" aria-label="anchor" href="#estimating-sigma2"></a>
</h2>
<p>Define <span class="math inline">\(G = I - Z(Z'Z)^{-1}Z'\)</span></p>
<p>In the the first model, the usual estimator of <span class="math inline">\(\sigma^2\)</span> would be <span class="math display">\[
\begin{aligned}
\hat \sigma_1^2 &amp;= \frac{1}{n - (p_x + p_z)} (y - X \hat \alpha_1 - Z \hat \beta_1)' (y - X \hat \alpha_1 - Z \hat \beta_1) \\
&amp;= \frac{1}{n - (p_x + p_z)} y' \left[I - \begin{pmatrix} X &amp; Z \end{pmatrix} \begin{pmatrix} X'X &amp; X'Z \\ Z'X &amp; Z'Z \end{pmatrix}^{-1} \begin{pmatrix} X &amp; Z \end{pmatrix}' \right] y\\
&amp;= \frac{1}{n - (p_x + p_z)} y' \left[I - X (X'GX)^{-1} X'G - Z(Z'HZ)^{-1} Z'H \right] y
\end{aligned}
\]</span></p>
<!-- Proof of last line
\[
\begin{aligned}
a &= \begin{pmatrix} X'X & X'Z \\ Z'X & Z'Z \end{pmatrix}^{-1
} \\
&= \begin{pmatrix} (X'GX)^{-1} & 0 \\ 0 & (Z'HZ)^{-1} \end{pmatrix} \begin{pmatrix} I & - X'Z (Z'Z)^{-1} \\ - Z'X (X'X)^{-1} & I \end{pmatrix}
\end{aligned}
\]

\[
\begin{aligned}
\begin{pmatrix}X & Z \\ 0 & 0 \end{pmatrix}\begin{pmatrix} (X'GX)^{-1} & 0 \\ 0 & (Z'HZ)^{-1} \end{pmatrix}
 &= \begin{pmatrix}
 X (X'GX)^{-1} & Z (Z'HZ) ^{-1} \\
 0 & 0 \end{pmatrix}
 \end{aligned}
\]

\[
\begin{pmatrix} I & - X'Z (Z'Z)^{-1} \\ - Z'X (X'X)^{-1} & I \end{pmatrix} \begin{pmatrix} X' & 0 \\ Z' & 0 \end{pmatrix} = 
\begin{pmatrix}
X'G & 0 \\
Z'H & 0
\end{pmatrix}
\]

\[
\begin{pmatrix} X & Z \end{pmatrix} \begin{pmatrix} X'X & X'Z \\ Z'X & Z'Z \end{pmatrix}^{-1} \begin{pmatrix} X & Z \end{pmatrix}' =
\begin{pmatrix} X (X'GX)^{-1} X' G + Z(Z'HZ)^{-1} Z'H & 0 \\
0 & 0\end{pmatrix} = X (X'GX)^{-1} X'G + Z(Z'HZ)^{-1} Z'H
\]
-->
<p>In the second case, the usual naive estimate of the variance that does not take into account the fact that <span class="math inline">\(\hat \alpha_2\)</span> is random would be</p>
<p><span class="math display">\[ 
\begin{aligned}
\hat \sigma_2^2  
  &amp;= \frac{1}{n - p_z} (y - X \hat \alpha_2 - Z \hat \beta_2)' (y - X \hat \alpha_2 - Z \hat \beta_2) \\
  &amp;= \frac{1}{n - p_z} y' (H - Z (Z'Z)^{-1} Z' H )' (H - Z (Z'Z)^{-1} Z' H) y \\
  &amp;= \frac{1}{n - p_z} y' [(I - Z (Z'Z)^{-1} Z') H ]' (I - Z (Z'Z)^{-1} Z') H y \\
  &amp;= \frac{1}{n - p_z} y' H G H y 
\end{aligned}
\]</span></p>
</div>
<div class="section level2">
<h2 id="todo">TODO<a class="anchor" aria-label="anchor" href="#todo"></a>
</h2>
<ul>
<li>Relate the above to estimating equations for the joint and sequential models. Chapter 7 of Boos and Stefanskiâ€™s textbook contains relevant material for the combined model. The errors-in-variables textbook has the extensions for the sequential models.</li>
<li>Implement as tests. See <code>test.cov_adj.R</code> for verifications of these results.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by First Last.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
