<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to propertee • propertee</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to propertee">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">propertee</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.0.0.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Basic</h6></li>
    <li><a class="dropdown-item" href="../articles/intro-to-propertee.html">Introduction to propertee</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/non-binary-treatment.html">Non-binary Treatment Specification</a></li>
    <li><a class="dropdown-item" href="../articles/RDD.html">Regression Discontinuity Designs</a></li>
    <li><a class="dropdown-item" href="../articles/geex_vs_propertee.html">propertee vs. geex</a></li>
    <li><a class="dropdown-item" href="../articles/mi_vignette/index.html">Real-data demonstration with a finely stratified cluster RCT and a broader administrative database</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/benbhansen-stats/propertee/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to propertee</h1>
                        <h4 data-toc-skip class="author">propertee
Authors</h4>
            
            <h4 data-toc-skip class="date">2025-08-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/benbhansen-stats/propertee/blob/main/vignettes/intro-to-propertee.Rmd" class="external-link"><code>vignettes/intro-to-propertee.Rmd</code></a></small>
      <div class="d-none name"><code>intro-to-propertee.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="main-features">Main Features<a class="anchor" aria-label="anchor" href="#main-features"></a>
</h2>
<p>The <strong>propertee</strong> package, Prognostic Regression Offsets
with Propagation of ERrors (for Treatment Effect Estimation),
facilitates direct adjustment or standardization for experiments and
observational studies, with the option of using a separately fitted
prognostic regression model for covariance adjustment. Propertee calls
for a self-standing specification of a study’s design and treatment
allocations, using these to create weights needed to align treatment and
control samples for estimation of treatment effects averaged across a
common standard population, with standard errors that appropriately
reflect the study design. For covariance adjustment it enables
offsetting the outcome against predictions from a dedicated covariance
model, with standard error calculations propagating error as appropriate
from the covariance model.</p>
<p>The main workflow consists of two main steps and one optional
step:</p>
<ol style="list-style-type: decimal">
<li>Encode the study’s design, including the unit of assignment,
treatment status of each unit of assignment, and block membership
information as appropriate, in a <code>StudySpecification</code> object.
This is accomplished with the <code><a href="../reference/StudySpecification_objects.html">obs_spec()</a></code>,
<code><a href="../reference/StudySpecification_objects.html">rct_spec()</a></code> or <code><a href="../reference/StudySpecification_objects.html">rd_spec()</a></code> functions.</li>
<li>Optionally, fit a covariate adjustment model. This is done with any
of a number of modeling functions external to <code>propertee</code>,
for example <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> or <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> from the
<code>stats</code> package, or <code>lmrob</code> from the
<code>robustbase</code> package.</li>
<li>Use <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> to contrast the separately reweighted
treatment and control groups, incorporating optional covariance
adjustments as an <code>offset</code> to <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code>. The
<code>StudySpecification</code> is unobtrusively retained, as is error
propagation from the optional covariance adjustment, for use in
subsequent standard error calculations. This is done using the
<code><a href="../reference/lmitt.html">lmitt()</a></code> function, which either takes and enriches a fitted
<code>lm</code> or, in the more fully supported usage, internally calls
<code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> to itself create a directly adjusted contrast of
treatment conditions.</li>
</ol>
</div>
<div class="section level2">
<h2 id="example-data">Example Data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<p>The example dataset comes from the state of Tennessee’s
Student-Teacher Achievement Ratio (STAR) experiment. Students were
randomly assigned to three possible classroom conditions: small (13 to
17 students per teacher), regular class (22 to 25 students per teacher),
and regular-with-aide class (22 to 25 students with a full-time
teacher’s aide).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"STARplus"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">STARplus</span><span class="op">$</span><span class="va">cond_at_entry</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         regular    regular+aide           small nonexperimental </span></span>
<span><span class="co">#&gt;            4328            4249            3024            1780</span></span></code></pre></div>
<p>For simplicity for this first example, we will examine a single
binary treatment - “small” classrooms versus “regular” and
“regular+aide” classrooms.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">STARplus</span><span class="op">$</span><span class="va">cond_small</span> <span class="op">&lt;-</span> <span class="va">STARplus</span><span class="op">$</span><span class="va">cond_at_entry</span> <span class="op">==</span> <span class="st">"small"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">STARplus</span><span class="op">$</span><span class="va">cond_small</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; FALSE  TRUE </span></span>
<span><span class="co">#&gt; 10357  3024</span></span></code></pre></div>
<p>After this basic example, we will see how <strong>propertee</strong>
makes it easy to handle non-binary treatment variables by introducing
<code>dichotomy</code>s.</p>
<p>The outcome of interest is a reading score at the end of
kindergarten.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">STARplus</span><span class="op">$</span><span class="va">g1treadss</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span><span class="co">#&gt;   404.0   478.0   516.0   521.5   558.0   651.0    5805</span></span></code></pre></div>
<p>We first take the random assignment scheme to have been either
complete or Bernoulli randomization of students, separately by school.
(Later we’ll change this to the more realistic assumption of complete or
Bernoulli randomization, separately by school <em>and</em> year of entry
into the study.) Accordingly, experimental blocks are given by the
<code>school_at_entry</code> variable.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">STARplus</span><span class="op">$</span><span class="va">school_at_entry</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 81</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">STARplus</span><span class="op">$</span><span class="va">school_at_entry</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 112038 123056 128068 128076 128079 130085 </span></span>
<span><span class="co">#&gt;    129     85     54     96    135    135</span></span></code></pre></div>
<p>We need a unique identifier for the unit by which treatment was
allocated. STAR treatments were assigned to students, as opposed to
classrooms or other aggregates of students; accordingly we need a unique
identifier per student. The <code>stdntid</code> variable fills this
role.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">STARplus</span><span class="op">$</span><span class="va">stdntid</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 13381</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">STARplus</span><span class="op">$</span><span class="va">stdntid</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 10000 10001 10002 10003 10004 10005</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="a-basic-example">A Basic Example<a class="anchor" aria-label="anchor" href="#a-basic-example"></a>
</h2>
<div class="section level3">
<h3 id="defining-the-studyspecification">Defining the <code>StudySpecification</code><a class="anchor" aria-label="anchor" href="#defining-the-studyspecification"></a>
</h3>
<p>The three <code>_spec</code> functions (<code><a href="../reference/StudySpecification_objects.html">rct_spec()</a></code>,
<code>obj_spec()</code>, and <code><a href="../reference/StudySpecification_objects.html">rd_spec()</a></code>) operate similarly.
The first argument is the most important, and encodes all the
specification information through the use of a formula. The left-hand
side of the formula identifies the treatment variable. The right-hand
side of the formula consists of the following potential pieces of
information:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="../reference/StudySpecificationSpecials.html">unit_of_assignment()</a></code>: This identifies the variable(s)
which indicate the units of assignment. This is required for all
specifications. The alias <code><a href="../reference/StudySpecificationSpecials.html">uoa()</a></code> can be used in its
place.</li>
<li>
<code><a href="../reference/StudySpecificationSpecials.html">block()</a></code>: The identifies the variable(s) which contain
block information. Optional.</li>
<li>
<code><a href="../reference/StudySpecificationSpecials.html">forcing()</a></code>: In regression discontinuity specifications
(<code><a href="../reference/StudySpecification_objects.html">rd_spec()</a></code>), this identifies the variable(s) which contain
forcing information.</li>
</ol>
<p>To define a <code>StudySpecification</code> in our example:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/StudySpecification_objects.html">obs_spec</a></span><span class="op">(</span><span class="va">cond_small</span> <span class="op">~</span> <span class="fu"><a href="../reference/StudySpecificationSpecials.html">unit_of_assignment</a></span><span class="op">(</span><span class="va">stdntid</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/StudySpecificationSpecials.html">block</a></span><span class="op">(</span><span class="va">school_at_entry</span><span class="op">)</span>,</span>
<span>                  data <span class="op">=</span> <span class="va">STARplus</span>, na.fail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span></span>
<span><span class="co">#&gt; Observational Study</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Structure          Variables      </span></span>
<span><span class="co">#&gt;  ---------          ---------      </span></span>
<span><span class="co">#&gt;  Treatment          cond_small     </span></span>
<span><span class="co">#&gt;  Unit of Assignment stdntid        </span></span>
<span><span class="co">#&gt;  Block              school_at_entry</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of units per Treatment group: </span></span>
<span><span class="co">#&gt;  Txt Grp Num Units</span></span>
<span><span class="co">#&gt;    FALSE      8577</span></span>
<span><span class="co">#&gt;     TRUE      3024</span></span></code></pre></div>
<p>Should additional variables be needed to identify the unit of
assignment, block, or forcing, they can be included. Had the variable
identifying the years in which participants entered the study been
available, for example, we might have identified the experimental blocks
as combinations of school and year of study entry, rather than as the
school alone. To do this we would pass
<code>block(year_at_entry, school_at_entry)</code>, rather than
<code>block(school_at_entry)</code>, in the above.</p>
</div>
<div class="section level3">
<h3 id="estimating-the-treatment-effect">Estimating the treatment effect<a class="anchor" aria-label="anchor" href="#estimating-the-treatment-effect"></a>
</h3>
<p>The main function for estimating treatment effects is the
<code><a href="../reference/lmitt.html">lmitt()</a></code> function. It takes in three main required
arguments:</p>
<ol style="list-style-type: decimal">
<li>A formula specifying the outcome and the desired treatment
effect.</li>
<li>The data set containing the outcome information.</li>
<li>A <a href="#defining-the-specification"><code>StudySpecification</code></a>.</li>
</ol>
<p>Note that the data set does <strong>not</strong> need to be the same
data set which generated the <code>StudySpecification</code>; it does
however need to include the same variables to identify the units of
assignment. (If the variable names differ, the <code>by=</code> argument
can be used to link them, though we recommend renaming to reduce the
likelihood of issues.)</p>
<p>For example, you may have one dataset containing school-level
information, and a separate dataset containing student-level
information. Assume school is the unit of assignment. While you could of
course merge those two data-sets, <strong>propertee</strong> can instead
use the school-level data to define the <code>StudySpecification</code>,
and the student-level data to estimate the treatment effect.</p>
<p>The formula entering <code><a href="../reference/lmitt.html">lmitt()</a></code> can take on one of two
forms:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">~</span> <span class="fl">1</span></span></code></pre></div>
<p>will estimate the main treatment effect on outcome variable
<code>y</code>, and</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span></span></code></pre></div>
<p>will estimate subgroup specific treatment effects for each level of
<code>x</code> for the outcome <code>y</code>, if <code>x</code> is
categorical. For continuous <code>x</code>, a main effect and a
treatment-<code>x</code> interaction effect is estimated.</p>
<p>Therefore, to estimate the treatment effect in our example, we can
run:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">te</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lmitt.html">lmitt</a></span><span class="op">(</span><span class="va">g1treadss</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">STARplus</span>, specification <span class="op">=</span> <span class="va">spec</span><span class="op">)</span></span>
<span><span class="co">#&gt; The StudySpecification object contains block-level information, but it is not used in this model. Block information is used when weights are defined via `ate()` or `ett()` or if the `absorb=TRUE` argument is passed.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">te</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lmitt(g1treadss ~ 1, data = STARplus, specification = spec)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Treatment Effects :</span></span>
<span><span class="co">#&gt;                       Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; cond_small.TRUE        12.6024     1.5938   7.907 2.84e-15 ***</span></span>
<span><span class="co">#&gt; g1treadss:(Intercept) 517.4628     0.7898 655.150  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Std. Error calculated via type "HC0"</span></span></code></pre></div>
<p>The data includes ethnicity; we can estimate subgroup effects by
ethnicity:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">te_s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lmitt.html">lmitt</a></span><span class="op">(</span><span class="va">g1treadss</span> <span class="op">~</span> <span class="va">race</span>, data <span class="op">=</span> <span class="va">STARplus</span>, specification <span class="op">=</span> <span class="va">spec</span><span class="op">)</span></span>
<span><span class="co">#&gt; The StudySpecification object contains block-level information, but it is not used in this model. Block information is used when weights are defined via `ate()` or `ett()` or if the `absorb=TRUE` argument is passed.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">te_s</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: The following subgroups do not have sufficient degrees of freedom for</span></span>
<span><span class="co">#&gt; standard error estimates and will be returned as NA: racemssng</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lmitt(g1treadss ~ race, data = STARplus, specification = spec)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Treatment Effects: (1 not defined because of singularities)</span></span>
<span><span class="co">#&gt;                           Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; cond_small.TRUE_racewhite   9.6229     1.9779   4.865 1.16e-06 ***</span></span>
<span><span class="co">#&gt; cond_small.TRUE_raceblack  16.4164     2.3296   7.047 1.92e-12 ***</span></span>
<span><span class="co">#&gt; cond_small.TRUE_raceasian -19.3846    29.7818  -0.651    0.515    </span></span>
<span><span class="co">#&gt; cond_small.TRUE_racehispa  43.1667    50.6159   0.853    0.394    </span></span>
<span><span class="co">#&gt; cond_small.TRUE_racenatam  12.5000    37.2522   0.336    0.737    </span></span>
<span><span class="co">#&gt; cond_small.TRUE_raceother   8.0000    30.4991   0.262    0.793    </span></span>
<span><span class="co">#&gt; cond_small.TRUE_racemssng       NA         NA      NA       NA    </span></span>
<span><span class="co">#&gt; g1treadss:racewhite       530.4149     0.9873 537.252  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; g1treadss:raceblack       492.0263     1.0665 461.335  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; g1treadss:raceasian       552.3846    16.8166  32.848  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; g1treadss:racehispa       526.5000    25.1480  20.936  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; g1treadss:racenatam       490.0000    26.1639  18.728  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; g1treadss:raceother       547.0000    19.0245  28.752  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; g1treadss:racemssng       480.0000         NA      NA       NA    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; Std. Error calculated via type "HC0"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="including-specification-weights">Including specification weights<a class="anchor" aria-label="anchor" href="#including-specification-weights"></a>
</h3>
<p>Study specification weights can be easily included in this
estimation. <strong>propertee</strong> supports average treatment effect
(ATE) and effect of the treatment on the treated (ETT) weights.</p>
<p>To include one of the weights, simply include the
<code>weights = "ate"</code> or <code>weights = "ett"</code> argument to
<code><a href="../reference/lmitt.html">lmitt()</a></code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lmitt.html">lmitt</a></span><span class="op">(</span><span class="va">g1treadss</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">STARplus</span>, specification <span class="op">=</span> <span class="va">spec</span>, weights <span class="op">=</span> <span class="st">"ate"</span><span class="op">)</span></span>
<span><span class="co">#&gt;       cond_small.TRUE g1treadss:(Intercept) </span></span>
<span><span class="co">#&gt;              11.35214             517.91270</span></span>
<span><span class="fu"><a href="../reference/lmitt.html">lmitt</a></span><span class="op">(</span><span class="va">g1treadss</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">STARplus</span>, specification <span class="op">=</span> <span class="va">spec</span>, weights <span class="op">=</span> <span class="st">"ett"</span><span class="op">)</span></span>
<span><span class="co">#&gt;       cond_small.TRUE g1treadss:(Intercept) </span></span>
<span><span class="co">#&gt;              10.88851             519.17669</span></span></code></pre></div>
<p>Internally, these call the <code><a href="../reference/WeightCreators.html">ate()</a></code> or <code><a href="../reference/WeightCreators.html">ett()</a></code>
functions which can be used directly.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/WeightCreators.html">ate</a></span><span class="op">(</span><span class="va">spec</span>, data <span class="op">=</span> <span class="va">STARplus</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.448276 1.237013 1.433071 1.413793 1.675676 1.361345</span></span></code></pre></div>
<p>When included inside <code><a href="../reference/lmitt.html">lmitt()</a></code>, you do not need to specify
any additional arguments to <code><a href="../reference/WeightCreators.html">ate()</a></code> or <code><a href="../reference/WeightCreators.html">ett()</a></code>,
enabling easy functions of weights. For example if you had some other
weight variable, say <code>wgt</code>, you could include
<code>weights = wgt*ate()</code> in the <code><a href="../reference/lmitt.html">lmitt()</a></code> call.</p>
</div>
<div class="section level3">
<h3 id="covariance-adjustment-models">Covariance Adjustment models<a class="anchor" aria-label="anchor" href="#covariance-adjustment-models"></a>
</h3>
<p>By itself, <code><a href="../reference/lmitt.html">lmitt()</a></code> does not allow for other covariates;
e.g. something like <code>lmitt(y ~ 1 + control_var,...</code> will
fail. To adjust for covariates, a separate covariate model should be
fit. Any model which supports a <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> function should
work.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">camod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">g1treadss</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">*</span> <span class="va">dob</span> <span class="op">+</span> <span class="va">race</span>, data <span class="op">=</span> <span class="va">STARplus</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/cov_adj.html">cov_adj()</a></code> function can be used to process the
covariance adjustment model and produce the required values; and its
output can be passed as an <code>offset=</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lmitt.html">lmitt</a></span><span class="op">(</span><span class="va">g1treadss</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">STARplus</span>, specification <span class="op">=</span> <span class="va">spec</span>,</span>
<span>      weights <span class="op">=</span> <span class="st">"ate"</span>, offset <span class="op">=</span> <span class="fu"><a href="../reference/cov_adj.html">cov_adj</a></span><span class="op">(</span><span class="va">camod</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;       cond_small.TRUE g1treadss:(Intercept) </span></span>
<span><span class="co">#&gt;              11.03055             517.91270</span></span></code></pre></div>
<p>Similarly to the weight functions, <code><a href="../reference/cov_adj.html">cov_adj()</a></code> attempts to
locate the correct arguments (in this case, mainly the
<code>data=</code> argument) to use in the model command; while
<code><a href="../reference/cov_adj.html">cov_adj()</a></code> does fall back to using the data which is in the
covariance model, its safer to use the <code>newdata=</code> argument if
calling <code><a href="../reference/cov_adj.html">cov_adj()</a></code> outside of the model.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/cov_adj.html">cov_adj</a></span><span class="op">(</span><span class="va">camod</span>, newdata <span class="op">=</span> <span class="va">STARplus</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 519.6613 528.8581 495.1975 531.1456 500.2958 490.3070</span></span></code></pre></div>
<p>Also, similarly to weights, <code><a href="../reference/cov_adj.html">cov_adj()</a></code> can be used in
normal modeling commands as well.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">g1treadss</span> <span class="op">~</span> <span class="va">cond_small</span>, data <span class="op">=</span> <span class="va">STARplus</span>, weights <span class="op">=</span> <span class="fu"><a href="../reference/WeightCreators.html">ate</a></span><span class="op">(</span><span class="va">spec</span><span class="op">)</span>,</span>
<span>   offset <span class="op">=</span> <span class="fu"><a href="../reference/cov_adj.html">cov_adj</a></span><span class="op">(</span><span class="va">camod</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = g1treadss ~ cond_small, data = STARplus, weights = ate(spec), </span></span>
<span><span class="co">#&gt;     offset = cov_adj(camod))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;    (Intercept)  cond_smallTRUE  </span></span>
<span><span class="co">#&gt;         -3.266          11.031</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="absorbing-blocks">Absorbing Blocks<a class="anchor" aria-label="anchor" href="#absorbing-blocks"></a>
</h3>
<p>If fixed effects for blocks are desired, which can be absorbed away
to avoid estimating, the <code>absorb=TRUE</code> argument can be
passed.</p>
<!-- currently not working due to #210, thus turned off-->
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lmitt.html">lmitt</a></span><span class="op">(</span><span class="va">g1treadss</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">STARplus</span>, specification <span class="op">=</span> <span class="va">spec</span>, absorb <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Josh Errickson, Josh Wasserman, Ben Hansen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
