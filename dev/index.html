<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Standardization-Based Effect Estimation with Optional Prior Covariance Adjustment • propertee</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Standardization-Based Effect Estimation with Optional Prior Covariance Adjustment">
<meta name="description" content="The Prognostic Regression Offsets with Propagation of ERrors (for Treatment Effect Estimation) package facilitates direct adjustment for experiments and observational studies that is compatible with a range of study designs and covariance adjustment strategies. It uses explicit specification of clusters, blocks and treatment allocations to furnish probability of assignment-based weights targeting any of several average treatment effect parameters, and for standard error calculations reflecting these design parameters. For covariance adjustment of its Hajek and (one-way) fixed effects estimates, it enables offsetting the outcome against predictions from a dedicated covariance model, with standard error calculations propagating error as appropriate from the covariance model.">
<meta property="og:description" content="The Prognostic Regression Offsets with Propagation of ERrors (for Treatment Effect Estimation) package facilitates direct adjustment for experiments and observational studies that is compatible with a range of study designs and covariance adjustment strategies. It uses explicit specification of clusters, blocks and treatment allocations to furnish probability of assignment-based weights targeting any of several average treatment effect parameters, and for standard error calculations reflecting these design parameters. For covariance adjustment of its Hajek and (one-way) fixed effects estimates, it enables offsetting the outcome against predictions from a dedicated covariance model, with standard error calculations propagating error as appropriate from the covariance model.">
<meta property="og:image" content="https://benbhansen-stats.github.io/propertee/logo.png">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">propertee</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.0.4.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Basic</h6></li>
    <li><a class="dropdown-item" href="articles/intro-to-propertee.html">Introduction to propertee</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="articles/non-binary-treatment.html">Non-binary Treatment Specification</a></li>
    <li><a class="dropdown-item" href="articles/RDD.html">Regression Discontinuity Designs</a></li>
    <li><a class="dropdown-item" href="articles/geex_vs_propertee.html">propertee vs. geex</a></li>
    <li><a class="dropdown-item" href="articles/mi_vignette/index.html">Real-data demonstration with a finely stratified cluster RCT and a broader administrative database</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/benbhansen-stats/propertee/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="propertee-prognostic-regression-offsets-with-propagation-of-errors-for-treatment-effect-estimation-">propertee: <strong>P</strong>rognostic <strong>R</strong>egression <strong>O</strong>ffsets with <strong>P</strong>ropagation of <strong>ER</strong>rors, for <strong>T</strong>reatment <strong>E</strong>ffect <strong>E</strong>stimation <a class="anchor" aria-label="anchor" href="#propertee-prognostic-regression-offsets-with-propagation-of-errors-for-treatment-effect-estimation-"></a>
</h1>
</div>
<!-- badges: start -->

<p><strong>propertee</strong> enables flexible direct adjustment with specification-informed standard errors and optional prior covariance adjustment.</p>
<p>Random trials often utilize units of assignment and blocking in assigning treatment status as a way to simplify implementation. Standard errors and other inferential calculations should respect such aspects of the study’s design. Using <strong>propertee</strong>, a user can generate a “StudySpecification” object which will keep track of the design specification.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>spec <span class="ot">&lt;-</span> <span class="fu">rct_spec</span>(txt <span class="sc">~</span> <span class="fu">unit_of_assignment</span>(teacher) <span class="sc">+</span> <span class="fu">block</span>(school), <span class="at">data =</span> teacherdata)</span></code></pre></div>
<p>(Also supported are observational studies (<code><a href="reference/StudySpecification_objects.html">obs_spec()</a></code>) and regression discontinuity specifications (<code>rdd_spec()</code> which requires a <code><a href="reference/StudySpecificationSpecials.html">forcing()</a></code> variable as well.)</p>
<p>In order to pass the design specification into the model using the <code>weights=</code> argument, functions <code><a href="reference/WeightCreators.html">ett()</a></code> and <code><a href="reference/WeightCreators.html">ate()</a></code> will be used to convert the StudySpecification into a numeric vector with the StudySpecification object as an attribute.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> txt, <span class="at">data =</span> studentdata, <span class="at">weights =</span> <span class="fu">ate</span>(spec))</span></code></pre></div>
<p>Note that this StudySpecification is created with teacher level data (<code>teacherdata</code>), but the analysis is carried out at the student level (<code>studentdata</code>); the <code><a href="reference/WeightCreators.html">ate()</a></code> (and its alternatives <code><a href="reference/WeightCreators.html">att()</a></code>, <code><a href="reference/WeightCreators.html">atc()</a></code> and <code><a href="reference/WeightCreators.html">ato()</a></code>) will expand the weights appropriately.</p>
<p>Optionally, we can also include a covariance adjustment model through the <code><a href="reference/cov_adj.html">cov_adj()</a></code> function.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>covadjmod <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> ..., <span class="at">data =</span> studentdata, <span class="at">subset =</span> <span class="sc">!</span>txt)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> txt, studentdata, <span class="at">weights =</span> <span class="fu">ett</span>(spec),</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>   <span class="at">offset =</span> <span class="fu">cov_adj</span>(covadjmod, <span class="at">data =</span> studentdata)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>)</span></code></pre></div>
<p>The effect estimation model is expected to be an lm object, but the covariance model can be of type <code>glm</code> or <code>lmrob</code>, among others: with a binary outcome, for example, it might be a logistic regression.</p>
<p>Having fit covariance and effect estimation models separately, you may need standard errors that propagate variation from the former to the latter. propertee’s “lmitt” objects are lm’s enhanced with information from the StudySpecification and covariance adjustment model that standard error calculations may need. Fitted lm’s of the accommodated type may be coerced to lmitt using <code><a href="reference/as_lmitt.html">as.lmitt()</a></code>; or you can skip this step by using <code><a href="reference/lmitt.html">propertee::lmitt()</a></code> to fit the lm in the first place:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">lmitt</span>(y <span class="sc">~</span> <span class="dv">1</span>, studentdata, <span class="at">specificaton =</span> spec, <span class="at">weights =</span> <span class="st">"ett"</span>,</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>      <span class="at">offset =</span> <span class="fu">cov_adj</span>(covadjmod, <span class="at">data =</span> studentdata)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  )</span></code></pre></div>
<p>For more, see the package’s vignettes.</p>
<div class="section level2">
<h2 id="contributing">Contributing<a class="anchor" aria-label="anchor" href="#contributing"></a>
</h2>
<p>You may use RStudio to develop for <strong>propertee</strong>, by opening the <code>propertee.Rproj</code> file. We suggest you ensure all required dependencies are installed by running</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_deps</span>(<span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>We prefer changes that include unit tests demonstrating the problem or showing how the new feature should be added. The test suite uses the <a href="https://github.com/hadley/test_that" class="external-link">testthat</a> package to write and run tests. (Please ensure you have the latest version of testthat (or at least v0.11.0), as older versions stored the tests in a different directory, and may not test properly.) See the <code>tests/testthat</code> directory for examples. You can run the test suite via Build -&gt; Test Package.</p>
<p>New features should include inline <a href="http://roxygen.org/" class="external-link">Roxygen</a> documentation. You can generate all <code>.Rd</code> documents from the <code>Roxygen</code> code using Build -&gt; Document, or using Make as describe below.</p>
<p>Finally, you can use Build -&gt; Build and Reload or Build -&gt; Clean and Rebuild to load an updated version of <strong>propertee</strong> in your current RStudio session. Alternatively, to install the developed version permanently, use Build -&gt; Build Binary Version, followed by</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"../propertee_VERSION.tgz"</span>, <span class="at">repo=</span><span class="cn">NULL</span>)</span></code></pre></div>
<p>You can revert back to the current CRAN version by</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">remove.packages</span>(<span class="st">"propertee"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"propertee"</span>)</span></code></pre></div>
<p>If you prefer not to use RStudio, you can develop using Make.</p>
<ul>
<li>
<code>make test</code>: Run the full test suite.</li>
<li>
<code>make document</code>: Update all documentation from Roxygen inline comments.</li>
<li>
<code>make interactive</code>: Start up an interactive session with <strong>propertee</strong> loaded. (<code>make interactive-emacs</code> starts the session inside emacs.)</li>
<li>
<code>make check</code>: Run <code>R CMD check</code> on the package</li>
<li>
<code>make build</code>: Build a binary package.</li>
<li>
<code>make vignette</code>: Builds any vignettes in <code>vignettes/</code> directory</li>
<li>
<code>make clean</code>: Removes files built by <code>make vignette</code>, <code>make document</code> or <code>make    check</code>. Should not be generally necessary, but can be useful for debugging.</li>
</ul>
<p>When your change is ready, make a pull request on github.</p>
<div class="section level3">
<h3 id="white-space-changes">White space changes<a class="anchor" aria-label="anchor" href="#white-space-changes"></a>
</h3>
<p>To ease searches of the commit history:</p>
<ul>
<li>Commit white space changes only when they occur on lines with substantive changes.</li>
<li>Avoid committing trailing white spaces.</li>
</ul>
<p>In <strong>RStudio</strong>, there are options to enable automatically removing white space as the end of lines and trailing whitespaces in the Settings, Code -&gt; Saving.</p>
<p>In <strong>emacs</strong>, you can remove white spaces at ends of lines with <code>M-x delete-trailing-whitespace</code>. To do this automatically whenever you save, add the following to your init file:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>(add<span class="sc">-</span>hook <span class="st">'before-save-hook (lambda ()</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="st">                             (delete-trailing-whitespace)))</span></span></code></pre></div>
<p>To remove trailing lines when saving, you can also add this:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>(setq delete<span class="sc">-</span>trailing<span class="sc">-</span>lines t)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="referring-to-functions">Referring to functions<a class="anchor" aria-label="anchor" href="#referring-to-functions"></a>
</h3>
<p>When documentation refers to another function (internal to the package or otherwise), please include the trailing <code>()</code>, as that will help <strong>pkgdown</strong> provide an appropriate link (see <a href="https://pkgdown.r-lib.org/articles/linking.html" class="external-link">https://pkgdown.r-lib.org/articles/linking.html</a>).</p>
<p>E.g. <code>\code{lm()}</code> or <code>\code{cov_adj()}</code> or <code>\code{lme4::lmer()}</code>.</p>
</div>
<div class="section level3">
<h3 id="vignettes-or-simulations">Vignettes or simulations<a class="anchor" aria-label="anchor" href="#vignettes-or-simulations"></a>
</h3>
<p>Vignettes and simulations should go in the <a href="https://github.com/benbhansen-stats/propertee/tree/main/vignettes" class="external-link">/vignettes/</a> folder. Anything that should not be built by R check (especially anything that builds very slowly, or introduces dependencies not specified in <a href="https://github.com/benbhansen-stats/propertee/blob/main/DESCRIPTION" class="external-link">DESCRIPTION</a>) should go in the <a href="https://github.com/benbhansen-stats/propertee/tree/main/vignettes/not-for-cran" class="external-link">/vignettes/not-for-cran</a>. (The not-for-cran folder is in the <a href="https://github.com/benbhansen-stats/propertee/blob/main/.Rbuildignore" class="external-link">.Rbuildignore</a> file.)</p>
<p>Note that ALL .Rmd files in /vignettes/ get built during building of the reference site. To exclude a .Rmd file, it needs to start with “_“. E.g. <code>myslowvignette.Rmd</code> -&gt; <code>_myslowvignette.Rmd</code>.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=propertee" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/benbhansen-stats/propertee/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/benbhansen-stats/propertee/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing propertee</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Josh Errickson <br><small class="roles"> Maintainer, author </small>   </li>
<li>Josh Wasserman <br><small class="roles"> Author </small>   </li>
<li>Ben Hansen <br><small class="roles"> Author </small>   </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=propertee" class="external-link"><img src="https://www.r-pkg.org/badges/version/propertee" alt="CRAN_Status_Badge"></a></li>
<li><a href="https://github.com/benbhansen-stats/propertee/actions" class="external-link"><img src="https://github.com/benbhansen-stats/propertee/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Josh Errickson, Josh Wasserman, Ben Hansen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
